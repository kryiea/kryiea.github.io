import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,d as l,e as h,o as t}from"./app-CB9WG6K8.js";const k="/assets/channel.001-Du8XfJBQ.png",e="/assets/channel.002-hgAN1YH5.png",p="/assets/channel.003-D1-__l4w.png",r="/assets/channel.004-BPdvPQ9r.png",d="/assets/channel.005-DB9HSVhn.png",g="/assets/channel.006-CUu6IX_6.png",c="/assets/channel.007-78Vzvp-k.png",y="/assets/channel.008-BEPyXsbL.png",A="/assets/channel.009-CdTzoTPs.png",B="/assets/channel.010-C-pB3zv2.png",o="/assets/channel.011-C6lDCm3g.png",E="/assets/channel.012-DLSoroVg.png",u="/assets/channel.013-CvTTroVj.png",C="/assets/channel.014-CTe1nmJM.png",m="/assets/channel.015-BvnQ66nn.png",F={};function v(f,i){return t(),a("div",null,[i[0]||(i[0]=n("p",null,"æœ¬æ–‡è¯¦ç»†ä»‹ç»Goè¯­è¨€Channelçš„åº•å±‚å®ç°åŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚",-1)),l(" more "),i[1]||(i[1]=h('<h2 id="_1-channelç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1-channelç®€ä»‹"><span>1. Channelç®€ä»‹</span></a></h2><p>Channelæ˜¯Goè¯­è¨€å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼š</p><ul><li>Goè¯­è¨€éµå¾ªCSPå¹¶å‘ç¼–ç¨‹æ¨¡å¼ï¼ˆ<strong>Communicating Sequential Process</strong> é€šä¿¡é¡ºåºè¿›ç¨‹ï¼‰ï¼Œæå€¡é€šè¿‡é€šä¿¡æ¥å®ç°å†…å­˜å…±äº«ï¼Œè€Œä¸æå€¡é€šè¿‡å…±äº«å†…å­˜æ¥å®ç°é€šä¿¡</li><li>Channelçš„å­˜åœ¨ï¼Œä½¿Goçš„å¹¶å‘å˜å¾—ç®€å•å¿«æ·</li><li>Channelå’Œselectçš„æ­é…ä½¿ç”¨ä»¥åŠè°ƒåº¦å™¨å¯¹goroutineçš„è°ƒåº¦ï¼Œå¯ä»¥é«˜æ•ˆå®ç°åç¨‹çš„é˜»å¡å’Œå”¤é†’åŠå¤šè·¯å¤ç”¨</li></ul><h2 id="_2-channelçš„åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#_2-channelçš„åˆ†ç±»"><span>2. Channelçš„åˆ†ç±»</span></a></h2><p>Channelæ ¹æ®ç¼“å†²åŒºå¤§å°å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><h3 id="_2-1-æœ‰ç¼“å†²channel" tabindex="-1"><a class="header-anchor" href="#_2-1-æœ‰ç¼“å†²channel"><span>2.1 æœ‰ç¼“å†²Channel</span></a></h3><ol><li>è¯»å†™æ—¶æ˜¯é˜»å¡çš„ï¼Œå‘channelå†™å…¥ä¸€æ¡æ•°æ®ï¼Œå¦‚æœè¿™æ¡æ•°æ®è¿˜æ²¡è¢«æ¶ˆè´¹æ‰ï¼Œå†å†™å…¥æ–°çš„æ•°æ®å°±ä¼šé˜»å¡</li><li>è¯»å–ä¹Ÿæ˜¯ï¼Œå½“channelæ²¡æœ‰å¯è¯»çš„æ•°æ®ï¼Œå†è¯»å–å°±ä¼šé˜»å¡</li></ol><h3 id="_2-2-æ— ç¼“å†²channel" tabindex="-1"><a class="header-anchor" href="#_2-2-æ— ç¼“å†²channel"><span>2.2 æ— ç¼“å†²Channel</span></a></h3><ol><li>è¯»å†™æ˜¯éé˜»å¡çš„ï¼Œä½†æ˜¯è¦æ»¡è¶³ä¸€å®šæ¡ä»¶â€”â€”é˜Ÿåˆ—æ²¡æ»¡</li><li>å¦‚æœchannelé˜Ÿåˆ—æ»¡äº†ï¼Œå°±ä¼šé€€åŒ–æˆæ— ç¼“å†²channelä¸€æ ·</li></ol><figure><img src="'+k+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><h2 id="_3-channelçš„æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_3-channelçš„æ•°æ®ç»“æ„"><span>3. Channelçš„æ•°æ®ç»“æ„</span></a></h2><p>Channelç”¨makeåˆ›å»ºåˆå§‹åŒ–ä¼šåœ¨å †ä¸Šåˆ†é…ä¸€ä¸ªruntime.hchanç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¹¶è¿”å›æŒ‡é’ˆæŒ‡å‘å †ä¸Šè¿™å—hchanå†…å­˜åŒºåŸŸï¼Œæ‰€ä»¥channelæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ã€‚</p><p>ä¸ºä»€ä¹ˆåœ¨å †ä¸Šåˆ›å»ºè€Œä¸æ˜¯æ ˆä¸Šï¼Ÿå› ä¸ºchannelæ˜¯ç”¨æ¥å®ç°goroutineé—´é€šä¿¡çš„ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸå¾ˆå¯èƒ½ä¸å±€é™äºæŸä¸ªå…·ä½“çš„å‡½æ•°ã€‚</p><figure><img src="'+e+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><h3 id="_3-1-sendqå’Œrecvqå­—æ®µ" tabindex="-1"><a class="header-anchor" href="#_3-1-sendqå’Œrecvqå­—æ®µ"><span>3.1 sendqå’Œrecvqå­—æ®µ</span></a></h3><p>å­˜å‚¨å½“å‰channelç”±äºç¼“å†²åŒºï¼ˆbufï¼‰ä¸è¶³è€Œé˜»å¡çš„ï¼šè¦è¯»å–æˆ–è€…è¦å†™å…¥å½“å‰çš„channelçš„goroutineåˆ—è¡¨ã€‚</p><p>è¿™äº›ç­‰å¾…é˜Ÿåˆ—ä½¿ç”¨åŒå‘é“¾è¡¨waitqè¡¨ç¤ºï¼Œwaitqæ˜¯ä¸€ä¸ªå¯¹sudogé“¾è¡¨è¿›è¡Œå°è£…ä¹‹åçš„ä¸€ä¸ªç»“æ„ã€‚</p><p>å­—æ®µä¸ºsudogé˜Ÿåˆ—çš„é¦–å°¾æŒ‡é’ˆï¼Œé“¾è¡¨ä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯sudogç»“æ„ã€‚</p><h4 id="waitqç»“æ„" tabindex="-1"><a class="header-anchor" href="#waitqç»“æ„"><span>waitqç»“æ„</span></a></h4><figure><img src="'+p+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><h3 id="_3-2-sudogç»“æ„" tabindex="-1"><a class="header-anchor" href="#_3-2-sudogç»“æ„"><span>3.2 sudogç»“æ„</span></a></h3><p>sudogå’Œgoroutineä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»ï¼Œgoroutineæ˜¯ç»‘å®šåœ¨sudogä¸­è¿™ä¸ªç»“æ„ä¸Šçš„ï¼š</p><ul><li>recvqå¯ä»¥ç†è§£ä¸ºï¼šè¯»æ“ä½œé˜»å¡åœ¨channelçš„goroutineåˆ—è¡¨</li><li>sendqæ˜¯å†™æ“ä½œé˜»å¡åœ¨channelçš„goroutineåˆ—è¡¨</li></ul><figure><img src="'+r+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><figure><img src="'+d+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><h2 id="_4-channelæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_4-channelæ“ä½œ"><span>4. Channelæ“ä½œ</span></a></h2><h3 id="_4-1-channelåˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-1-channelåˆå§‹åŒ–"><span>4.1 Channelåˆå§‹åŒ–</span></a></h3><p>ç”¨makeå‡½æ•°åˆå§‹åŒ–ä¸€ä¸ªchannelï¼Œè€Œåœ¨è¿è¡Œæ—¶å…¶å®æ˜¯è°ƒç”¨makechanå‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–å·¥ä½œã€‚</p><p>æºç åˆ†æï¼š</p><figure><img src="'+g+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><ul><li>makechanæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä»£è¡¨åˆ›å»ºçš„channelçš„ç±»å‹ï¼Œå³æ˜¯é€šé“å¯ä»¥ä¼ é€’çš„æ¶ˆæ¯ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨é€šé“ä¸­çš„å…ƒç´ å¤§å°</li><li>åˆ›å»ºçš„ä¸»è¦é€»è¾‘ä½äºswitchä¸­ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š <ol><li>æ²¡æœ‰ç¼“å†²åŒºbufï¼Œå³åˆ›å»ºæ— ç¼“å†²åŒºçš„channelï¼Œåªåˆ†é…hchanæœ¬èº«ç»“æ„ä½“å¤§å°çš„å†…å­˜</li><li>æœ‰ç¼“å†²åŒºbufï¼Œä½†å…ƒç´ ç±»å‹ä¸å«æŒ‡é’ˆï¼Œä¸€æ¬¡ä¸ºå½“å‰çš„hchanç»“æ„å’Œbufæ•°ç»„åˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´</li><li>æœ‰ç¼“å†²åŒºï¼Œä¸”å…ƒç´ åŒ…å«æŒ‡é’ˆç±»å‹ï¼Œåˆ†ä¸¤æ¬¡åˆ†é…å†…å­˜ï¼Œå…ˆä¸ºhchanç»“æ„å’Œåˆ†é…å†…å­˜ï¼Œå†ä¸ºbufæ•°ç»„å…ƒç´ åˆ†é…å†…å­˜</li></ol></li></ul><p>ä¸åŒçŠ¶æ€çš„channelï¼Œå†™å…¥æ—¶ç»“æœå¦‚ä¸‹ï¼š</p><figure><img src="'+c+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><h3 id="_4-2-channelå†™å…¥" tabindex="-1"><a class="header-anchor" href="#_4-2-channelå†™å…¥"><span>4.2 Channelå†™å…¥</span></a></h3><p>è¿è¡Œæ—¶è°ƒç”¨äº†runtime.chansendå‡½æ•°ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure><img src="'+y+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><figure><img src="'+A+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><figure><img src="'+B+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>å‘channelå‘é€æ•°æ®åˆ†ä¸ºä¸‰ç§æ–¹å¼ï¼šç›´æ¥å‘é€ã€ç¼“å†²å‘é€ã€é˜»å¡å‘é€</p><ol><li>ç›´æ¥å‘é€ <ul><li>å½“å‰channelæœ‰æ­£åœ¨é˜»å¡ç­‰å¾…æ¥å—æ•°æ®çš„goroutineï¼Œé‚£ä¹ˆç›´æ¥å‘é€æ•°æ®ï¼Œç›´æ¥ä»ä¸€ä¸ªgoroutineæ“ä½œå¦ä¸€ä¸ªgoroutineçš„æ ˆï¼Œå°†å¾…å‘é€æ•°æ®ç›´æ¥copyåˆ°æ­¤å¤„</li></ul></li><li>ç¼“å†²å‘é€ <ul><li>ä¼šåˆ¤å®šç¼“å†²åŒºçš„å‰©ä½™ç©ºé—´ï¼Œå¦‚æœæœ‰å‰©ä½™ç©ºé—´ï¼Œå°†æ•°æ®æ‹·è´åˆ°channelä¸­ï¼Œsendxç´¢å¼•è‡ªå¢1ï¼ˆè‹¥sendxç­‰äºdataqsizï¼Œåˆ™å°†sendxç½®0ï¼ŒåŸå› æ˜¯bufæ˜¯ä¸€ä¸ªç¯å½¢æ•°ç»„ï¼‰è‡ªå¢å®Œæˆåï¼Œé˜Ÿåˆ—æ€»æ•°è‡ªå¢1</li></ul></li><li>é˜»å¡å‘é€ <ul><li>å½“å‰channelæ²¡æœ‰æ­£åœ¨é˜»å¡ç­‰å¾…æ¥å—æ•°æ®çš„goroutineï¼Œå¹¶ä¸”channelçš„ç¼“å†²åŒºæ»¡äº†ä¹‹åï¼Œå‘é€goroutineå°±ä¼šé˜»å¡ï¼Œé¦–å…ˆè·å–sudogï¼Œå°†å‘é€çš„goroutineç»‘å®šåˆ°sudogä¸Šï¼ŒåŠ å…¥åˆ°å½“å‰channelçš„å‘é€é˜»å¡é˜Ÿåˆ—ï¼Œè°ƒç”¨goparkæ–¹æ³•æŒ‚èµ·å½“å‰goroutineï¼Œç­‰å¾…è¢«å”¤é†’</li></ul></li></ol><figure><img src="'+o+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>æµç¨‹å›¾ï¼š</p><figure><img src="'+E+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><figure><img src="'+u+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><figure><img src="'+C+'" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><figure><img src="'+m+`" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><h3 id="_4-3-channelè¯»å–" tabindex="-1"><a class="header-anchor" href="#_4-3-channelè¯»å–"><span>4.3 Channelè¯»å–</span></a></h3><p>è¯»å–éƒ½æ˜¯è°ƒç”¨chanrecvå‡½æ•°åšæ•°æ®æ¥æ”¶ï¼Œä¸‹é¢æ˜¯chanrecvæºç ï¼š</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> chanrecv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">hchan</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ep</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> unsafe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Pointer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">block</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">selected</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">received</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // ç‰¹æ®Šåœºæ™¯ï¼šéé˜»å¡æ¨¡å¼ï¼Œå¹¶ä¸”æ²¡æœ‰å…ƒç´ çš„åœºæ™¯ç›´æ¥å°±å¯ä»¥è¿”å›äº†ï¼Œè¿™ä¸ªåˆ†æ”¯æ˜¯å¿«é€Ÿåˆ†æ”¯ï¼Œä¸‹é¢çš„ä»£ç éƒ½æ˜¯åœ¨é”å†…çš„ï¼›</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">block</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dataqsiz</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sendq</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">first</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ||</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dataqsiz</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> atomic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Loaduint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qcount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  atomic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Load</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">closed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // ä»¥ä¸‹æ‰€æœ‰çš„é€»è¾‘éƒ½åœ¨é”å†…ï¼›</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">closed</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qcount</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> raceenabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   raceacquire</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">raceaddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ep</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   typedmemclr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">elemtype</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // åœºæ™¯ï¼šå¦‚æœå‘ç°æœ‰ä¸ªäººï¼ˆsenderï¼‰æ­£åœ¨ç­‰ç€åˆ«äººæ¥æ”¶ï¼Œé‚£ä¹ˆåˆšåˆšå¥½ï¼Œç›´æ¥æŠŠå®ƒçš„å…ƒç´ ç»™åˆ°æˆ‘ä»¬è¿™é‡Œå°±å¥½äº†ï¼›</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sg</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sendq</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dequeue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sg</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  recv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() { </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) }, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // åœºæ™¯ï¼šringbuffer è¿˜æœ‰ç©ºé—´å­˜å…ƒç´ ï¼Œé‚£ä¹ˆä¸‹é¢å°±å¯ä»¥æŠŠå…ƒç´ æ”¾åˆ° ringbuffer æ”¾å¥½ï¼Œé€’å¢ç´¢å¼•ï¼Œå°±å¯ä»¥è¿”å›äº†ï¼›</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qcount</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å­˜å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  qp</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> chanbuf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">recvx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ep</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   typedmemmove</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">elemtype</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  typedmemclr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">elemtype</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // é€’å¢ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">recvx</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">++</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">recvx</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dataqsiz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">   c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">recvx</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">qcount</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">--</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // ä»£ç åˆ°è¿™è¯´æ˜ ringbuffer ç©ºé—´æ˜¯ä¸å¤Ÿçš„ï¼Œåé¢è¦åšä¸¤ä¸ªäº‹æƒ…ï¼Œæ˜¯å¦éœ€è¦é˜»å¡ï¼Ÿ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // å¦‚æœ block ä¸º false ï¼Œé‚£ä¹ˆç›´æ¥å°±é€€å‡ºäº†ï¼Œè¿”å›å¯¹åº”çš„è¿”å›å€¼ï¼›</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">block</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // åˆ°è¿™å°±è¯´æ˜è¦é˜»å¡ç­‰å¾…äº†ï¼Œä¸‹é¢å”¯ä¸€è¦åšçš„å°±æ˜¯ç»™é˜»å¡åšå‡†å¤‡ï¼ˆå‡†å¤‡å¥½å”¤é†’çš„æ¡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> acquireSudog</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">releasetime</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">elem</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> ep</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">waitlink</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">waiting</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">g</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">isSelect</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">param</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // goroutine ä½œä¸ºä¸€ä¸ª waiter å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…æ¡ä»¶æ»¡è¶³ä¹‹åï¼Œä»è¿™ä¸ªé˜Ÿåˆ—é‡Œå–å‡ºæ¥å”¤é†’ï¼›</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">recvq</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">enqueue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // goroutine åˆ‡èµ°ï¼Œäº¤å‡º cpu æ‰§è¡Œæƒé™</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> goparkunlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">waitReasonChanReceive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">traceEvGoBlockRecv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // è¿™é‡Œæ˜¯è¢«å”¤é†’çš„å¼€å§‹çš„åœ°æ–¹ï¼›</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">waiting</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  throw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;G waiting list is corrupted&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // ä¸‹é¢åšä¸€äº›èµ„æºçš„æ¸…ç†</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">waiting</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> closed</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">param</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> gp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">param</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mysg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-å‚è€ƒèµ„æ–™" tabindex="-1"><a class="header-anchor" href="#_5-å‚è€ƒèµ„æ–™"><span>5. å‚è€ƒèµ„æ–™</span></a></h2><ul><li><a href="https://zhuanlan.zhihu.com/p/297053654" target="_blank" rel="noopener noreferrer">Golang Channel æœ€è¯¦ç»†çš„æºç å‰–æ</a></li></ul>`,51))])}const _=s(F,[["render",v],["__file","channel.html.vue"]]),q=JSON.parse('{"path":"/back-end/go/DataStructure/channel.html","title":"Goè¯­è¨€Channelè¯¦è§£","lang":"zh-CN","frontmatter":{"title":"Goè¯­è¨€Channelè¯¦è§£","description":"è¯¦ç»†ä»‹ç»Goè¯­è¨€channelçš„æ¦‚å¿µã€ä½¿ç”¨æ–¹æ³•åŠå¹¶å‘é€šä¿¡æœºåˆ¶","date":"2024-01-01T00:00:00.000Z","category":["Go","æ•°æ®ç»“æ„","å¹¶å‘ç¼–ç¨‹"],"tag":["Go","Channel","å¹¶å‘","é€šä¿¡"],"head":[["meta",{"property":"og:url","content":"https://kryiea.cn/back-end/go/DataStructure/channel.html"}],["meta",{"property":"og:site_name","content":"ğŸ§kryiea"}],["meta",{"property":"og:title","content":"Goè¯­è¨€Channelè¯¦è§£"}],["meta",{"property":"og:description","content":"è¯¦ç»†ä»‹ç»Goè¯­è¨€channelçš„æ¦‚å¿µã€ä½¿ç”¨æ–¹æ³•åŠå¹¶å‘é€šä¿¡æœºåˆ¶"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-31T15:53:39.000Z"}],["meta",{"property":"article:tag","content":"Go"}],["meta",{"property":"article:tag","content":"Channel"}],["meta",{"property":"article:tag","content":"å¹¶å‘"}],["meta",{"property":"article:tag","content":"é€šä¿¡"}],["meta",{"property":"article:published_time","content":"2024-01-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-31T15:53:39.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Goè¯­è¨€Channelè¯¦è§£\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-01-01T00:00:00.000Z\\",\\"dateModified\\":\\"2025-03-31T15:53:39.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"kryiea\\",\\"url\\":\\"https://github.com/kryiea\\",\\"email\\":\\"kryieaa@outlook.com\\"}]}"]]},"headers":[{"level":2,"title":"1. Channelç®€ä»‹","slug":"_1-channelç®€ä»‹","link":"#_1-channelç®€ä»‹","children":[]},{"level":2,"title":"2. Channelçš„åˆ†ç±»","slug":"_2-channelçš„åˆ†ç±»","link":"#_2-channelçš„åˆ†ç±»","children":[{"level":3,"title":"2.1 æœ‰ç¼“å†²Channel","slug":"_2-1-æœ‰ç¼“å†²channel","link":"#_2-1-æœ‰ç¼“å†²channel","children":[]},{"level":3,"title":"2.2 æ— ç¼“å†²Channel","slug":"_2-2-æ— ç¼“å†²channel","link":"#_2-2-æ— ç¼“å†²channel","children":[]}]},{"level":2,"title":"3. Channelçš„æ•°æ®ç»“æ„","slug":"_3-channelçš„æ•°æ®ç»“æ„","link":"#_3-channelçš„æ•°æ®ç»“æ„","children":[{"level":3,"title":"3.1 sendqå’Œrecvqå­—æ®µ","slug":"_3-1-sendqå’Œrecvqå­—æ®µ","link":"#_3-1-sendqå’Œrecvqå­—æ®µ","children":[{"level":4,"title":"waitqç»“æ„","slug":"waitqç»“æ„","link":"#waitqç»“æ„","children":[]}]},{"level":3,"title":"3.2 sudogç»“æ„","slug":"_3-2-sudogç»“æ„","link":"#_3-2-sudogç»“æ„","children":[]}]},{"level":2,"title":"4. Channelæ“ä½œ","slug":"_4-channelæ“ä½œ","link":"#_4-channelæ“ä½œ","children":[{"level":3,"title":"4.1 Channelåˆå§‹åŒ–","slug":"_4-1-channelåˆå§‹åŒ–","link":"#_4-1-channelåˆå§‹åŒ–","children":[]},{"level":3,"title":"4.2 Channelå†™å…¥","slug":"_4-2-channelå†™å…¥","link":"#_4-2-channelå†™å…¥","children":[]},{"level":3,"title":"4.3 Channelè¯»å–","slug":"_4-3-channelè¯»å–","link":"#_4-3-channelè¯»å–","children":[]}]},{"level":2,"title":"5. å‚è€ƒèµ„æ–™","slug":"_5-å‚è€ƒèµ„æ–™","link":"#_5-å‚è€ƒèµ„æ–™","children":[]}],"git":{"createdTime":1743436419000,"updatedTime":1743436419000,"contributors":[{"name":"kryiea","email":"1582877056@qq.com","commits":1}]},"readingTime":{"minutes":5.31,"words":1594},"filePathRelative":"back-end/go/DataStructure/channel.md","localizedDate":"2024å¹´1æœˆ1æ—¥","excerpt":"<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»Goè¯­è¨€Channelçš„åº•å±‚å®ç°åŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚</p>\\n"}');export{_ as comp,q as data};
