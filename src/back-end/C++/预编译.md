---
title: C++预编译详解
description: 详细介绍C++预编译过程、宏定义及头文件包含等预处理指令
date: 2024-01-01
category:
  - C++
  - 编译原理
tag:
  - 预编译
  - 宏定义
  - C++
  - 条件编译
---

**预编译**

**define宏定义**

被定义为"宏"的标识符称为"宏名"。在编译预处理时，对程序中所有出现的"宏名"，**都用宏定义中的字符串去代换，这称为"宏代换"或"宏展开"**。

优点：

(1) 方便程序的修改。这个就不多说了。

(2） 提高程序的运行效率。

使用带参数的宏定义可完成函数调用的功能，又能减少系统开销，提高运行效率。

正如C语言中所讲，函数的使用可以使程序更加模块化，便于组织，而且可重复利用，但在发生函数调用时，需要保留调用函数的现场，以便子函数执行结束后能返回继续执行，同样在子函数执行完后要恢复调用函数的现场，这都需要一定的时间

如果子函数执行的操作比较多，这种转换时间开销可以忽略，但如果子函数完成的功能比较少，甚至于只完成一点操作，如一个乘法语句的操作，则这部分转换开销就相对较大了，但使用带参数的宏定义就不会出现这个问题，因为它是在预处理阶段即进行了宏展开，在执行时不需要转换，即在当地执行。

宏定义可完成简单的操作，但复杂的操作还是要由函数调用来完成，而且宏定义所占用的目标代码空间相对较大。所以在使用时要依据具体情况来决定是否使用宏定义。

` `**带参宏和不带参宏**

```C
//带参
#define MAX(a,b) (a<b)? b:a 
int main(){
        int a=6,b=2;
        int c=MAX(a,b);
 }
//不带参数
#define OK 1
```
1. #include 包含头文件

预处理阶段进行的替换工作，将头文件.h中的内容替换到.c文件

#包含头文件就是为了将声明或者源代码替换到当前.c文件中

```C
 #incldude<iostream>
在预处理的时候，会先对#进行预处理，将<iostream>文件的代码替换掉 #incldude<iostream>这一行代码
而iostream文件中有50000多行代码，所以预处理后的文件，会加上这5w行代码
```
2. #if和#endif 是否执行该代码段

在预处理阶段进行

```C++
//会执行
#if 1
int add(int a, int b){
}
#endif
/////////////////////////////////////////////////////////////////////
//不会执行
#if 0 
int add(int a, int b){
}
#endif
```
**ifndef防止头文件的重复包含和编译**

它是if not define 的简写，是宏定义的一种，实际上确切的说，这应该是预处理功能三种（宏定义、文件包含、条件编译）中的一种----条件编译。
**条件指示符#ifndef 的最主要目的是防止头文件的重复包含和编译。**


```C
#ifndef x                 //先测试x是否被宏定义过
#define x
   程序段1   //如果x没有被宏定义过，定义x，并编译程序段 1
#endif   
　　程序段2　　 //如果x已经定义过了则编译程序段2的语句，"忽视"程序段 1
```


