<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.59" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://kryiea.cn/back-end/mysql/principle/%E9%94%81.html"><meta property="og:site_name" content="ğŸ§kryiea"><meta property="og:title" content="MySQLé”æœºåˆ¶è¯¦è§£"><meta property="og:description" content="æ·±å…¥åˆ†æMySQLçš„é”ç±»å‹ã€åŠ é”åŸç†åŠå¹¶å‘æ§åˆ¶æœºåˆ¶"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-03-31T15:53:39.000Z"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="é”æœºåˆ¶"><meta property="article:tag" content="å¹¶å‘æ§åˆ¶"><meta property="article:tag" content="æ€§èƒ½ä¼˜åŒ–"><meta property="article:published_time" content="2024-01-01T00:00:00.000Z"><meta property="article:modified_time" content="2025-03-31T15:53:39.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MySQLé”æœºåˆ¶è¯¦è§£","image":[""],"datePublished":"2024-01-01T00:00:00.000Z","dateModified":"2025-03-31T15:53:39.000Z","author":[{"@type":"Person","name":"kryiea","url":"https://github.com/kryiea","email":"kryieaa@outlook.com"}]}</script><title>MySQLé”æœºåˆ¶è¯¦è§£ | ğŸ§kryiea</title><meta name="description" content="æ·±å…¥åˆ†æMySQLçš„é”ç±»å‹ã€åŠ é”åŸç†åŠå¹¶å‘æ§åˆ¶æœºåˆ¶">
    <link rel="preload" href="/assets/style-CT-7IuSv.css" as="style"><link rel="stylesheet" href="/assets/style-CT-7IuSv.css">
    <link rel="modulepreload" href="/assets/app-DRR9Yo7Y.js"><link rel="modulepreload" href="/assets/é”.html-D3ptGFhe.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-BPxQ0yma.js" as="script"><link rel="prefetch" href="/assets/intro.html-BkOIZxpG.js" as="script"><link rel="prefetch" href="/assets/index.html-CizTAqjX.js" as="script"><link rel="prefetch" href="/assets/vscode.html-D_6pJweg.js" as="script"><link rel="prefetch" href="/assets/index.html-99kMvy-i.js" as="script"><link rel="prefetch" href="/assets/index.html-CERxvZuw.js" as="script"><link rel="prefetch" href="/assets/æµ·é‡æ•°æ®å¤„ç†.html-DTIg5tlf.js" as="script"><link rel="prefetch" href="/assets/é˜²é‡è®¾è®¡ä¸æ¥å£å¹‚ç­‰è®¾è®¡.html-kjB1KY1x.js" as="script"><link rel="prefetch" href="/assets/GCCã€GDB.html-BuEela3A.js" as="script"><link rel="prefetch" href="/assets/index.html-DWqHY0-c.js" as="script"><link rel="prefetch" href="/assets/c__ç‰¹æ€§.html-CnfmIHFk.js" as="script"><link rel="prefetch" href="/assets/åŸºç¡€å¤ä¹ .html-CprFerX_.js" as="script"><link rel="prefetch" href="/assets/é¢„ç¼–è¯‘.html-h6zyQ2HS.js" as="script"><link rel="prefetch" href="/assets/index.html-Cty9l1oa.js" as="script"><link rel="prefetch" href="/assets/äºŒåˆ†çº¢è“æŸ“è‰²æ³•.html-wyXLTiYH.js" as="script"><link rel="prefetch" href="/assets/äºŒå‰å †.html-CMDmvz7p.js" as="script"><link rel="prefetch" href="/assets/äºŒå‰æ ‘.html-DOvjq-f7.js" as="script"><link rel="prefetch" href="/assets/å“ˆå¸Œç®—æ³•.html-BWG_iyCD.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-DRlQpr3J.js" as="script"><link rel="prefetch" href="/assets/index.html-BTskjSte.js" as="script"><link rel="prefetch" href="/assets/é›ªèŠ±ç®—æ³•.html-Bp3wePRA.js" as="script"><link rel="prefetch" href="/assets/FrameworkAndcore.html-CG_iO0_G.js" as="script"><link rel="prefetch" href="/assets/index.html-CI7gnSFG.js" as="script"><link rel="prefetch" href="/assets/commands.html-CVvWiJyI.js" as="script"><link rel="prefetch" href="/assets/index.html-D52przz6.js" as="script"><link rel="prefetch" href="/assets/index.html-B1rAFsqJ.js" as="script"><link rel="prefetch" href="/assets/Kafkaæ¶æ„.html-CDMq17c3.js" as="script"><link rel="prefetch" href="/assets/Kafkaé«˜å¯ç”¨.html-DUpsLa2f.js" as="script"><link rel="prefetch" href="/assets/index.html-BQLV-3fH.js" as="script"><link rel="prefetch" href="/assets/index.html-y7EcmQFf.js" as="script"><link rel="prefetch" href="/assets/Shellç”¨æˆ·å’Œç»„.html-BSU4ztOH.js" as="script"><link rel="prefetch" href="/assets/linuxå‘½ä»¤.html-BpJCNzMo.js" as="script"><link rel="prefetch" href="/assets/vimå‘½ä»¤.html-D81Xkcqw.js" as="script"><link rel="prefetch" href="/assets/å†…å­˜ç®¡ç†.html-CyWBB7pd.js" as="script"><link rel="prefetch" href="/assets/å†…æ ¸æ€ä¸ç”¨æˆ·æ€.html-B1-9TBy9.js" as="script"><link rel="prefetch" href="/assets/æ–‡ä»¶ç³»ç»Ÿ.html-B_9ibgF6.js" as="script"><link rel="prefetch" href="/assets/ç½‘ç»œç¼–ç¨‹.html-C_zQgMIj.js" as="script"><link rel="prefetch" href="/assets/Protobuf.html-Cg4se1RV.js" as="script"><link rel="prefetch" href="/assets/index.html-B0iV1Ikj.js" as="script"><link rel="prefetch" href="/assets/index.html-jaz4nmp0.js" as="script"><link rel="prefetch" href="/assets/index.html-BBWsUZ4w.js" as="script"><link rel="prefetch" href="/assets/ä¼ è¾“å±‚.html-BtArg8lF.js" as="script"><link rel="prefetch" href="/assets/åº”ç”¨å±‚.html-B-0F8CIz.js" as="script"><link rel="prefetch" href="/assets/ç½‘ç»œå®‰å…¨.html-Y1M7J0bY.js" as="script"><link rel="prefetch" href="/assets/è™šæ‹Ÿæœºç½‘ç»œæ¨¡å¼.html-DNWNAzVq.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œè¯­é›€å¯¼å…¥.html-DEdFLyRm.js" as="script"><link rel="prefetch" href="/assets/index.html-Uv8XNCCa.js" as="script"><link rel="prefetch" href="/assets/channel.html-Cg6U0gdr.js" as="script"><link rel="prefetch" href="/assets/context.html-DCLvPDFd.js" as="script"><link rel="prefetch" href="/assets/defer.html-CUR1Gk6X.js" as="script"><link rel="prefetch" href="/assets/interface.html-Bglaa7DW.js" as="script"><link rel="prefetch" href="/assets/map.html-Dkx-1_Lp.js" as="script"><link rel="prefetch" href="/assets/slice.html-FWEhCRlu.js" as="script"><link rel="prefetch" href="/assets/string.html-B7wt-K9Z.js" as="script"><link rel="prefetch" href="/assets/demoToGmp.html-CXN6wS-c.js" as="script"><link rel="prefetch" href="/assets/gmp.html-DwLOd-xr.js" as="script"><link rel="prefetch" href="/assets/Compiler.html-CM0c_tir.js" as="script"><link rel="prefetch" href="/assets/memoryEscape.html-DZe821ye.js" as="script"><link rel="prefetch" href="/assets/multiReturns.html-D7hxm1L7.js" as="script"><link rel="prefetch" href="/assets/GrammarBasics.html-D1itCc1c.js" as="script"><link rel="prefetch" href="/assets/jsonPackage.html-BMzcoG8T.js" as="script"><link rel="prefetch" href="/assets/strings.html-DPWNxvxR.js" as="script"><link rel="prefetch" href="/assets/syncmap.html-Dozt2UoP.js" as="script"><link rel="prefetch" href="/assets/Exception.html-CxK7nUk8.js" as="script"><link rel="prefetch" href="/assets/Reflection.html-DRS0gA5V.js" as="script"><link rel="prefetch" href="/assets/JavaBasics.html-D9wfp-Hd.js" as="script"><link rel="prefetch" href="/assets/Filter.html-CdjuSYBE.js" as="script"><link rel="prefetch" href="/assets/Listener.html-dycBYDJm.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-CFshrBkv.js" as="script"><link rel="prefetch" href="/assets/Spring.html-D7NC1e_x.js" as="script"><link rel="prefetch" href="/assets/kafka-practice.html-sKxUtD4A.js" as="script"><link rel="prefetch" href="/assets/åˆ†åº“åˆ†è¡¨.html-C_WQcb3d.js" as="script"><link rel="prefetch" href="/assets/è¯»å†™åˆ†ç¦»ã€ä¸»ä»åŒæ­¥.html-DMZC3rJk.js" as="script"><link rel="prefetch" href="/assets/log.html-vs8MoPOL.js" as="script"><link rel="prefetch" href="/assets/InnoDBå­˜å‚¨å¼•æ“.html-BvpPzMsq.js" as="script"><link rel="prefetch" href="/assets/äº‹åŠ¡.html-CRLH0DA7.js" as="script"><link rel="prefetch" href="/assets/åŸç†åˆ†ç±».html-BtbRZgyB.js" as="script"><link rel="prefetch" href="/assets/æ€§èƒ½è°ƒä¼˜.html-BUNmR4LB.js" as="script"><link rel="prefetch" href="/assets/æ—¥å¿—.html-B8sZ0tr_.js" as="script"><link rel="prefetch" href="/assets/ç´¢å¼•.html-DxAAvY_U.js" as="script"><link rel="prefetch" href="/assets/é€»è¾‘æ¶æ„.html-Lk3m6bXp.js" as="script"><link rel="prefetch" href="/assets/sqlæ‰§è¡Œé¡ºåº.html-BMK1-tj9.js" as="script"><link rel="prefetch" href="/assets/sqlç´¢å¼•.html-CqdS8YpK.js" as="script"><link rel="prefetch" href="/assets/sqlè¯­æ³•.html-CCGjdJ4H.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®åº“ç®¡ç†.html-uBTSWdaw.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®ç±»å‹.html-CyjxhIqu.js" as="script"><link rel="prefetch" href="/assets/hash.html-wDK9QkS-.js" as="script"><link rel="prefetch" href="/assets/hashtableåº•å±‚ç»“æ„.html-ChBwLb_n.js" as="script"><link rel="prefetch" href="/assets/list.html-BSbbZyhe.js" as="script"><link rel="prefetch" href="/assets/set.html-CxVqktGS.js" as="script"><link rel="prefetch" href="/assets/string.html-4VrRijFB.js" as="script"><link rel="prefetch" href="/assets/zset.html-D8FikSYR.js" as="script"><link rel="prefetch" href="/assets/å‹ç¼©åˆ—è¡¨.html-BN6vIpaZ.js" as="script"><link rel="prefetch" href="/assets/å¯¹è±¡è¿‡æœŸæ—¶é—´.html-BAeV_A3Y.js" as="script"><link rel="prefetch" href="/assets/è·³è¡¨.html-CNA2kpEH.js" as="script"><link rel="prefetch" href="/assets/rediså•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«.html-DIGvHMeK.js" as="script"><link rel="prefetch" href="/assets/rediså•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹.html-DyruhYZ_.js" as="script"><link rel="prefetch" href="/assets/redisåœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆå­˜å‚¨çš„.html-C7olDoud.js" as="script"><link rel="prefetch" href="/assets/rediså¤šçº¿ç¨‹æ˜¯æ€ä¹ˆå›äº‹ï¼ˆæœªå®Œæˆï¼‰.html-B3ldJlci.js" as="script"><link rel="prefetch" href="/assets/redisèƒ½å­˜å¤šå°‘æ•°æ®.html-Dc8WVMa0.js" as="script"><link rel="prefetch" href="/assets/å†…å­˜æ·˜æ±°ç®—æ³•-LFU.html-SAZnyMMA.js" as="script"><link rel="prefetch" href="/assets/å†…å­˜æ·˜æ±°ç®—æ³•-LRU.html-BPc2dvZy.js" as="script"><link rel="prefetch" href="/assets/lock.html-BZsrY6gi.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼é”.html-PsF-EdpD.js" as="script"><link rel="prefetch" href="/assets/æ¶ˆæ¯é˜Ÿåˆ—.html-DeqkDaUP.js" as="script"><link rel="prefetch" href="/assets/ç§’æ€.html-BGaRyDUh.js" as="script"><link rel="prefetch" href="/assets/ç¼“å­˜.html-CRzVv9uF.js" as="script"><link rel="prefetch" href="/assets/é™æµå™¨.html-BN7Ic9vq.js" as="script"><link rel="prefetch" href="/assets/dataInMemory.html-BKq2RmoE.js" as="script"><link rel="prefetch" href="/assets/AOFä¼˜åŒ–-æ··åˆæŒä¹…åŒ–.html-TXDhzyUg.js" as="script"><link rel="prefetch" href="/assets/æŒä¹…åŒ–.html-BnJon-fZ.js" as="script"><link rel="prefetch" href="/assets/uber.zap.html-BoP5jOfj.js" as="script"><link rel="prefetch" href="/assets/Kratos.html-DFNw5U5M.js" as="script"><link rel="prefetch" href="/assets/Gorm.html-DGLL8c7U.js" as="script"><link rel="prefetch" href="/assets/Gin.html-crIxNQCS.js" as="script"><link rel="prefetch" href="/assets/bcryptåŠ å¯†.html-C8i-TL5Z.js" as="script"><link rel="prefetch" href="/assets/404.html-CW0z_wC5.js" as="script"><link rel="prefetch" href="/assets/index.html-DsRepDZV.js" as="script"><link rel="prefetch" href="/assets/index.html-Ur28xU9j.js" as="script"><link rel="prefetch" href="/assets/index.html-Bfc8zwmk.js" as="script"><link rel="prefetch" href="/assets/index.html-ca0LQFVJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BbXH8z8M.js" as="script"><link rel="prefetch" href="/assets/index.html-Cfotlke9.js" as="script"><link rel="prefetch" href="/assets/index.html-DpxYAtsm.js" as="script"><link rel="prefetch" href="/assets/index.html-DVskY8iv.js" as="script"><link rel="prefetch" href="/assets/index.html-BSNdvbiF.js" as="script"><link rel="prefetch" href="/assets/index.html-CvNi9mMu.js" as="script"><link rel="prefetch" href="/assets/index.html-CyJWL-rI.js" as="script"><link rel="prefetch" href="/assets/index.html-Ch2eUQFQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DuZrNLNo.js" as="script"><link rel="prefetch" href="/assets/index.html-C0jVoGUm.js" as="script"><link rel="prefetch" href="/assets/index.html-DLGDdtsK.js" as="script"><link rel="prefetch" href="/assets/index.html-BiDRm6nm.js" as="script"><link rel="prefetch" href="/assets/index.html-JC_u6EOm.js" as="script"><link rel="prefetch" href="/assets/index.html-BMxw4ygM.js" as="script"><link rel="prefetch" href="/assets/index.html-CVpGa40L.js" as="script"><link rel="prefetch" href="/assets/index.html-C3nHm_Jb.js" as="script"><link rel="prefetch" href="/assets/index.html-DVPiGgt-.js" as="script"><link rel="prefetch" href="/assets/index.html-07i1R1F_.js" as="script"><link rel="prefetch" href="/assets/index.html-CjHNOGdQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Dj5Gdahf.js" as="script"><link rel="prefetch" href="/assets/index.html-7NLyGzjY.js" as="script"><link rel="prefetch" href="/assets/index.html-CEfeKw6s.js" as="script"><link rel="prefetch" href="/assets/index.html-uQHdIbYH.js" as="script"><link rel="prefetch" href="/assets/index.html-yLb6JcIb.js" as="script"><link rel="prefetch" href="/assets/index.html-DdhZNnxd.js" as="script"><link rel="prefetch" href="/assets/index.html-TzT2oNmz.js" as="script"><link rel="prefetch" href="/assets/index.html-DrmfoxV3.js" as="script"><link rel="prefetch" href="/assets/index.html-wDd-f8fI.js" as="script"><link rel="prefetch" href="/assets/index.html-BhN_HSyz.js" as="script"><link rel="prefetch" href="/assets/index.html-BnCf2TKC.js" as="script"><link rel="prefetch" href="/assets/index.html-Bine456b.js" as="script"><link rel="prefetch" href="/assets/index.html-Bq0wyWx0.js" as="script"><link rel="prefetch" href="/assets/index.html-B0WeT6fV.js" as="script"><link rel="prefetch" href="/assets/index.html-NvyoXB8d.js" as="script"><link rel="prefetch" href="/assets/index.html-zTVrNVwP.js" as="script"><link rel="prefetch" href="/assets/index.html-BmpGsG-4.js" as="script"><link rel="prefetch" href="/assets/index.html-DjFJaTcm.js" as="script"><link rel="prefetch" href="/assets/index.html-DoleIlnM.js" as="script"><link rel="prefetch" href="/assets/index.html-DY0zd_iA.js" as="script"><link rel="prefetch" href="/assets/index.html-rnSIeur6.js" as="script"><link rel="prefetch" href="/assets/index.html-albCjJnB.js" as="script"><link rel="prefetch" href="/assets/index.html-DHAgjK5u.js" as="script"><link rel="prefetch" href="/assets/index.html-mx9vFEvD.js" as="script"><link rel="prefetch" href="/assets/index.html-Co0Zou0C.js" as="script"><link rel="prefetch" href="/assets/index.html-DMPWpDta.js" as="script"><link rel="prefetch" href="/assets/index.html-hxuzVaXi.js" as="script"><link rel="prefetch" href="/assets/index.html-DShQueDH.js" as="script"><link rel="prefetch" href="/assets/index.html-D-ZnQ0md.js" as="script"><link rel="prefetch" href="/assets/index.html-CQwZ7Y-w.js" as="script"><link rel="prefetch" href="/assets/index.html-SAfYTpPv.js" as="script"><link rel="prefetch" href="/assets/index.html-B2yxro9r.js" as="script"><link rel="prefetch" href="/assets/index.html-BH-iSNrw.js" as="script"><link rel="prefetch" href="/assets/index.html-C1Zh7A5T.js" as="script"><link rel="prefetch" href="/assets/index.html-DQLtjUeq.js" as="script"><link rel="prefetch" href="/assets/index.html-DegJzrrG.js" as="script"><link rel="prefetch" href="/assets/index.html-50tne7Hi.js" as="script"><link rel="prefetch" href="/assets/index.html-CaRyWdZ-.js" as="script"><link rel="prefetch" href="/assets/index.html-CswukXAQ.js" as="script"><link rel="prefetch" href="/assets/index.html-B4X1w4gU.js" as="script"><link rel="prefetch" href="/assets/index.html-CY7FBXqt.js" as="script"><link rel="prefetch" href="/assets/index.html-ClIVeJ7l.js" as="script"><link rel="prefetch" href="/assets/index.html-BS6lSHSQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DhfrHlco.js" as="script"><link rel="prefetch" href="/assets/index.html-e1Nnwzb-.js" as="script"><link rel="prefetch" href="/assets/index.html-Dt92_0BM.js" as="script"><link rel="prefetch" href="/assets/index.html-DT5NupV9.js" as="script"><link rel="prefetch" href="/assets/index.html--mY_fJHy.js" as="script"><link rel="prefetch" href="/assets/index.html-dsDCbnii.js" as="script"><link rel="prefetch" href="/assets/index.html-ioU5D0Vg.js" as="script"><link rel="prefetch" href="/assets/index.html-DbmLqcxL.js" as="script"><link rel="prefetch" href="/assets/index.html-BbgfZncT.js" as="script"><link rel="prefetch" href="/assets/index.html-CllQgBk-.js" as="script"><link rel="prefetch" href="/assets/index.html-DgrgmOzH.js" as="script"><link rel="prefetch" href="/assets/index.html-CxyUGFT-.js" as="script"><link rel="prefetch" href="/assets/index.html-BBCV2z16.js" as="script"><link rel="prefetch" href="/assets/index.html-B745HPpM.js" as="script"><link rel="prefetch" href="/assets/index.html-fHyYkrSK.js" as="script"><link rel="prefetch" href="/assets/index.html-l9-Ue-Ki.js" as="script"><link rel="prefetch" href="/assets/index.html-CqJ8Bvit.js" as="script"><link rel="prefetch" href="/assets/index.html-DlQO2gXn.js" as="script"><link rel="prefetch" href="/assets/index.html-DgYozVKO.js" as="script"><link rel="prefetch" href="/assets/index.html-C4hknF7Y.js" as="script"><link rel="prefetch" href="/assets/index.html-DrE69CU2.js" as="script"><link rel="prefetch" href="/assets/index.html-DHcGqR4c.js" as="script"><link rel="prefetch" href="/assets/index.html-CMaj6xxr.js" as="script"><link rel="prefetch" href="/assets/index.html-Cwsx4MFN.js" as="script"><link rel="prefetch" href="/assets/index.html-mIaSy6u6.js" as="script"><link rel="prefetch" href="/assets/index.html-BlnYtnyQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Cz0eQV6S.js" as="script"><link rel="prefetch" href="/assets/index.html-Bb2fVf-z.js" as="script"><link rel="prefetch" href="/assets/index.html-CCkN7vxT.js" as="script"><link rel="prefetch" href="/assets/index.html-CLIVxLw7.js" as="script"><link rel="prefetch" href="/assets/index.html-9CrMcA5O.js" as="script"><link rel="prefetch" href="/assets/index.html-CxTmi9v8.js" as="script"><link rel="prefetch" href="/assets/index.html-Cj7XLGEH.js" as="script"><link rel="prefetch" href="/assets/index.html-BPQ9nqe4.js" as="script"><link rel="prefetch" href="/assets/index.html-CSBLUTeo.js" as="script"><link rel="prefetch" href="/assets/index.html-DPrjOnqv.js" as="script"><link rel="prefetch" href="/assets/index.html-C1M1lYLn.js" as="script"><link rel="prefetch" href="/assets/index.html-DSSsd08J.js" as="script"><link rel="prefetch" href="/assets/index.html-C3CihSF9.js" as="script"><link rel="prefetch" href="/assets/index.html-D_T3OvEd.js" as="script"><link rel="prefetch" href="/assets/index.html-DKEJcnLL.js" as="script"><link rel="prefetch" href="/assets/index.html-HjE2gdkx.js" as="script"><link rel="prefetch" href="/assets/index.html-COmcJAAv.js" as="script"><link rel="prefetch" href="/assets/index.html-Cdtltwio.js" as="script"><link rel="prefetch" href="/assets/index.html-DgHPW7fX.js" as="script"><link rel="prefetch" href="/assets/index.html-BFHlqyiV.js" as="script"><link rel="prefetch" href="/assets/index.html-7D-_JXzz.js" as="script"><link rel="prefetch" href="/assets/index.html-Cr8VCIfT.js" as="script"><link rel="prefetch" href="/assets/index.html-Bh10J7dX.js" as="script"><link rel="prefetch" href="/assets/index.html-CzjACoSi.js" as="script"><link rel="prefetch" href="/assets/index.html-B_Qvf21Y.js" as="script"><link rel="prefetch" href="/assets/index.html-DLpqEt0q.js" as="script"><link rel="prefetch" href="/assets/index.html-CVwPWWEL.js" as="script"><link rel="prefetch" href="/assets/index.html-Ck7DMLor.js" as="script"><link rel="prefetch" href="/assets/index.html-_W1nRnO5.js" as="script"><link rel="prefetch" href="/assets/index.html-BDSWIR-Y.js" as="script"><link rel="prefetch" href="/assets/index.html-B91goNQX.js" as="script"><link rel="prefetch" href="/assets/index.html-DTC4aACZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CAeRV6-V.js" as="script"><link rel="prefetch" href="/assets/index.html-D0NvDApj.js" as="script"><link rel="prefetch" href="/assets/index.html-41HFrAWl.js" as="script"><link rel="prefetch" href="/assets/index.html-CXDVZLRq.js" as="script"><link rel="prefetch" href="/assets/index.html-CG_4apep.js" as="script"><link rel="prefetch" href="/assets/index.html-SdE8067p.js" as="script"><link rel="prefetch" href="/assets/index.html-Btaz-thV.js" as="script"><link rel="prefetch" href="/assets/index.html-mwEFecqf.js" as="script"><link rel="prefetch" href="/assets/index.html-CxmG-0AX.js" as="script"><link rel="prefetch" href="/assets/index.html-DtSN2_BI.js" as="script"><link rel="prefetch" href="/assets/index.html-BYbRsK5e.js" as="script"><link rel="prefetch" href="/assets/index.html-B92zdwYE.js" as="script"><link rel="prefetch" href="/assets/index.html-ClLRikJ8.js" as="script"><link rel="prefetch" href="/assets/index.html-BgmF4R46.js" as="script"><link rel="prefetch" href="/assets/index.html-2bwVDzAy.js" as="script"><link rel="prefetch" href="/assets/index.html-BBi3BHAK.js" as="script"><link rel="prefetch" href="/assets/index.html-BSuB6RNy.js" as="script"><link rel="prefetch" href="/assets/index.html-CLSiYHmm.js" as="script"><link rel="prefetch" href="/assets/index.html-7tZBrjiQ.js" as="script"><link rel="prefetch" href="/assets/index.html-a35g3e9j.js" as="script"><link rel="prefetch" href="/assets/index.html-DIWME3Ny.js" as="script"><link rel="prefetch" href="/assets/index.html-T85IVSAJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BxtOXDA9.js" as="script"><link rel="prefetch" href="/assets/index.html-CbcZ8yET.js" as="script"><link rel="prefetch" href="/assets/index.html-C58FgwRk.js" as="script"><link rel="prefetch" href="/assets/index.html-CTUpt-PU.js" as="script"><link rel="prefetch" href="/assets/index.html-DchY4sZ9.js" as="script"><link rel="prefetch" href="/assets/index.html-C1IJkf9-.js" as="script"><link rel="prefetch" href="/assets/index.html-Bryc9uFZ.js" as="script"><link rel="prefetch" href="/assets/index.html-B31Cfh0H.js" as="script"><link rel="prefetch" href="/assets/index.html-P9pn2qy3.js" as="script"><link rel="prefetch" href="/assets/index.html-BqVh914T.js" as="script"><link rel="prefetch" href="/assets/index.html-Dy7aY5TJ.js" as="script"><link rel="prefetch" href="/assets/index.html-B_vN62I5.js" as="script"><link rel="prefetch" href="/assets/index.html-CtAG8v9G.js" as="script"><link rel="prefetch" href="/assets/index.html-fcP4R_Of.js" as="script"><link rel="prefetch" href="/assets/index.html-yMkyKxMi.js" as="script"><link rel="prefetch" href="/assets/index.html-D90SNE-g.js" as="script"><link rel="prefetch" href="/assets/index.html-BSyKOfIh.js" as="script"><link rel="prefetch" href="/assets/index.html-CIxUQJLu.js" as="script"><link rel="prefetch" href="/assets/index.html-DgQyE5Sj.js" as="script"><link rel="prefetch" href="/assets/index.html-IvZA1bBS.js" as="script"><link rel="prefetch" href="/assets/index.html-Dy6oys0r.js" as="script"><link rel="prefetch" href="/assets/index.html-D37mxarN.js" as="script"><link rel="prefetch" href="/assets/index.html-DN7jVjM_.js" as="script"><link rel="prefetch" href="/assets/index.html-CE-pVuFQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BVuKkuuW.js" as="script"><link rel="prefetch" href="/assets/index.html-DeNEzfOf.js" as="script"><link rel="prefetch" href="/assets/index.html-BIBBWJPu.js" as="script"><link rel="prefetch" href="/assets/index.html-BTMeVrtQ.js" as="script"><link rel="prefetch" href="/assets/index.html-L7BTDzw4.js" as="script"><link rel="prefetch" href="/assets/index.html-CJej2idl.js" as="script"><link rel="prefetch" href="/assets/index.html-Dyma16aV.js" as="script"><link rel="prefetch" href="/assets/index.html-BXGIpBvK.js" as="script"><link rel="prefetch" href="/assets/index.html-BmzpHCJh.js" as="script"><link rel="prefetch" href="/assets/index.html-Ds7TPQeT.js" as="script"><link rel="prefetch" href="/assets/index.html-B52lO0bg.js" as="script"><link rel="prefetch" href="/assets/index.html-BUKkS2gW.js" as="script"><link rel="prefetch" href="/assets/index.html-DO0AWRlR.js" as="script"><link rel="prefetch" href="/assets/index.html-uRj77juW.js" as="script"><link rel="prefetch" href="/assets/index.html-Bj9HeJZ6.js" as="script"><link rel="prefetch" href="/assets/index.html-BclnIbpT.js" as="script"><link rel="prefetch" href="/assets/index.html-DBycJZmk.js" as="script"><link rel="prefetch" href="/assets/index.html-C_-SJL0J.js" as="script"><link rel="prefetch" href="/assets/index.html-VnqTS-Pe.js" as="script"><link rel="prefetch" href="/assets/index.html-ZRs_Gq35.js" as="script"><link rel="prefetch" href="/assets/index.html-BGuNDkeL.js" as="script"><link rel="prefetch" href="/assets/index.html-CpqimSA3.js" as="script"><link rel="prefetch" href="/assets/index.html-DCdmyFJO.js" as="script"><link rel="prefetch" href="/assets/index.html-B5kzuvp9.js" as="script"><link rel="prefetch" href="/assets/index.html-SZ4jWgjb.js" as="script"><link rel="prefetch" href="/assets/index.html-CGinXJFY.js" as="script"><link rel="prefetch" href="/assets/index.html-Ci0CuyAS.js" as="script"><link rel="prefetch" href="/assets/index.html-B9Z7jENU.js" as="script"><link rel="prefetch" href="/assets/index.html-DZU44tVO.js" as="script"><link rel="prefetch" href="/assets/index.html-czMV-vXS.js" as="script"><link rel="prefetch" href="/assets/index.html-DYc1DHcz.js" as="script"><link rel="prefetch" href="/assets/index.html-De-ypI7S.js" as="script"><link rel="prefetch" href="/assets/index.html-DXhC62Zk.js" as="script"><link rel="prefetch" href="/assets/index.html-DlXrJIW7.js" as="script"><link rel="prefetch" href="/assets/index.html-DBBUvXp3.js" as="script"><link rel="prefetch" href="/assets/index.html-B9MEvycL.js" as="script"><link rel="prefetch" href="/assets/index.html-aqcDDj9L.js" as="script"><link rel="prefetch" href="/assets/index.html-Brp3TOVL.js" as="script"><link rel="prefetch" href="/assets/index.html-Ddz5WKmz.js" as="script"><link rel="prefetch" href="/assets/index.html-1-H07r7c.js" as="script"><link rel="prefetch" href="/assets/index.html-gDKgm1af.js" as="script"><link rel="prefetch" href="/assets/index.html-46RXrs7B.js" as="script"><link rel="prefetch" href="/assets/index.html-BVi3iPZq.js" as="script"><link rel="prefetch" href="/assets/index.html-DzBVrUdI.js" as="script"><link rel="prefetch" href="/assets/index.html-CXHOq4-d.js" as="script"><link rel="prefetch" href="/assets/index.html-BcZE59Q8.js" as="script"><link rel="prefetch" href="/assets/index.html-DDMbqKiP.js" as="script"><link rel="prefetch" href="/assets/index.html-BTE0Yqaq.js" as="script"><link rel="prefetch" href="/assets/index.html-CN5vdkZZ.js" as="script"><link rel="prefetch" href="/assets/index.html-D5Hfw3Ka.js" as="script"><link rel="prefetch" href="/assets/index.html-B6IV5DMS.js" as="script"><link rel="prefetch" href="/assets/index.html-DXzme60Q.js" as="script"><link rel="prefetch" href="/assets/index.html-DtrNyA3n.js" as="script"><link rel="prefetch" href="/assets/index.html-B9owzh2K.js" as="script"><link rel="prefetch" href="/assets/index.html-DoklpgrK.js" as="script"><link rel="prefetch" href="/assets/index.html-DfU7uNfu.js" as="script"><link rel="prefetch" href="/assets/index.html-2zcjXKhG.js" as="script"><link rel="prefetch" href="/assets/index.html-QEXrA-ft.js" as="script"><link rel="prefetch" href="/assets/index.html-B8Th92JD.js" as="script"><link rel="prefetch" href="/assets/index.html-D8MIQ6dF.js" as="script"><link rel="prefetch" href="/assets/index.html-BNpsDm4f.js" as="script"><link rel="prefetch" href="/assets/index.html-Du3YX7VB.js" as="script"><link rel="prefetch" href="/assets/index.html-BKRpcKNd.js" as="script"><link rel="prefetch" href="/assets/index.html-DK8iHN71.js" as="script"><link rel="prefetch" href="/assets/index.html-CI5DlDTX.js" as="script"><link rel="prefetch" href="/assets/index.html-D_NX-0SG.js" as="script"><link rel="prefetch" href="/assets/index.html-B9T45_Q2.js" as="script"><link rel="prefetch" href="/assets/index.html-CzmuDEKx.js" as="script"><link rel="prefetch" href="/assets/index.html-DCXh4fc-.js" as="script"><link rel="prefetch" href="/assets/index.html-d_EEawzv.js" as="script"><link rel="prefetch" href="/assets/index.html-ddwPd5sR.js" as="script"><link rel="prefetch" href="/assets/index.html-CkE1WgVK.js" as="script"><link rel="prefetch" href="/assets/index.html-mm93UfZR.js" as="script"><link rel="prefetch" href="/assets/index.html-DiKrk0ZL.js" as="script"><link rel="prefetch" href="/assets/index.html-DKqosmw1.js" as="script"><link rel="prefetch" href="/assets/index.html-CO4I-AtJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BtHmplTe.js" as="script"><link rel="prefetch" href="/assets/index.html-Xk-qrmac.js" as="script"><link rel="prefetch" href="/assets/index.html-B1SC2pBo.js" as="script"><link rel="prefetch" href="/assets/index.html-DXgJsz-k.js" as="script"><link rel="prefetch" href="/assets/index.html-CXmcLVJf.js" as="script"><link rel="prefetch" href="/assets/index.html-CyB3vJC-.js" as="script"><link rel="prefetch" href="/assets/index.html-Bg5NylJo.js" as="script"><link rel="prefetch" href="/assets/index.html-PTRicCL-.js" as="script"><link rel="prefetch" href="/assets/index.html-DT4fGwsg.js" as="script"><link rel="prefetch" href="/assets/index.html-fFF_nzfB.js" as="script"><link rel="prefetch" href="/assets/index.html-Ctnq41Mi.js" as="script"><link rel="prefetch" href="/assets/index.html-DfA0BbRe.js" as="script"><link rel="prefetch" href="/assets/index.html-DaWWEIqh.js" as="script"><link rel="prefetch" href="/assets/index.html-Co3Q6koA.js" as="script"><link rel="prefetch" href="/assets/index.html-BMZmcVog.js" as="script"><link rel="prefetch" href="/assets/index.html-ffBnhuaj.js" as="script"><link rel="prefetch" href="/assets/index.html-VIiYCdFk.js" as="script"><link rel="prefetch" href="/assets/index.html-Dv5ddMcC.js" as="script"><link rel="prefetch" href="/assets/index.html-D9CtQRPP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bc40WwjS.js" as="script"><link rel="prefetch" href="/assets/index.html-DWaIP7Yh.js" as="script"><link rel="prefetch" href="/assets/index.html-ClI_My4l.js" as="script"><link rel="prefetch" href="/assets/index.html-gSNTrGpD.js" as="script"><link rel="prefetch" href="/assets/index.html-CBjAUHHh.js" as="script"><link rel="prefetch" href="/assets/index.html-Bim0DVcH.js" as="script"><link rel="prefetch" href="/assets/index.html-B5Kpe61l.js" as="script"><link rel="prefetch" href="/assets/index.html-eu8STz5U.js" as="script"><link rel="prefetch" href="/assets/index.html-DxcdKkkv.js" as="script"><link rel="prefetch" href="/assets/index.html-DlbQ7jbH.js" as="script"><link rel="prefetch" href="/assets/index.html-BPIMz9Vu.js" as="script"><link rel="prefetch" href="/assets/index.html-BPMKWI7Y.js" as="script"><link rel="prefetch" href="/assets/index.html-7X6Fh_8l.js" as="script"><link rel="prefetch" href="/assets/index.html-CR1u1wM9.js" as="script"><link rel="prefetch" href="/assets/index.html-Cg2EdcyC.js" as="script"><link rel="prefetch" href="/assets/index.html-CQJnkAgB.js" as="script"><link rel="prefetch" href="/assets/index.html-CyzIT8ev.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/SearchResult-JtuA-UkO.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-ByO6wJcw.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/" aria-label="å¸¦æˆ‘å›å®¶"><!----><!----><span class="vp-site-name">ğŸ§kryiea</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é¦–é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->é¦–é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="åç«¯"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-yin-yang" style=""></span>åç«¯<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/java/" aria-label="Java"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-java" style=""></span><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/go/" aria-label="Go"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-golang" style=""></span><!--]-->Go<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/C__/" aria-label="C++"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-code" style=""></span><!--]-->C++<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/linux/" aria-label="Linux"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/back-end/mysql/" aria-label="MySQL"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/redis/" aria-label="Redis"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/kafka/" aria-label="Kafka"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-server" style=""></span><!--]-->Kafka<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/docker/" aria-label="Docker"><!--[--><span class="font-icon icon fa-fw fa-sm fa-brands fa-docker" style=""></span><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/distributed/" aria-label="åˆ†å¸ƒå¼"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-network-wired" style=""></span><!--]-->åˆ†å¸ƒå¼<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/microservice/" aria-label="å¾®æœåŠ¡"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-cubes" style=""></span><!--]-->å¾®æœåŠ¡<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/algorithm/" aria-label="ç®—æ³•"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-code-branch" style=""></span><!--]-->ç®—æ³•<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/network/" aria-label="è®¡ç®—æœºç½‘ç»œ"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-globe" style=""></span><!--]-->è®¡ç®—æœºç½‘ç»œ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/back-end/Back-endOptimizationScenarios/" aria-label="åç«¯ä¼˜åŒ–åœºæ™¯"><!--[--><span class="font-icon icon fa-fw fa-sm fa-solid fa-gauge-high" style=""></span><!--]-->åç«¯ä¼˜åŒ–åœºæ™¯<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/front-end/" aria-label="å‰ç«¯"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-masks-theater" style=""></span><!--]-->å‰ç«¯<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/devConfig/" aria-label="é…ç½®&amp;æ’ä»¶"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->é…ç½®&amp;æ’ä»¶<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/intro.html" aria-label="å…³äº"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user" style=""></span><!--]-->å…³äº<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://kryiea.github.io/" target="_blank" rel="noopener noreferrer" aria-label="Source"><svg xmlns="http://www.w3.org/2000/svg" class="icon source-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="source icon" name="source" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M601.92 475.2c0 76.428-8.91 83.754-28.512 99.594-14.652 11.88-43.956 14.058-78.012 16.434-18.81 1.386-40.392 2.97-62.172 6.534-18.612 2.97-36.432 9.306-53.064 17.424V299.772c37.818-21.978 63.36-62.766 63.36-109.692 0-69.894-56.826-126.72-126.72-126.72S190.08 120.186 190.08 190.08c0 46.926 25.542 87.714 63.36 109.692v414.216c-37.818 21.978-63.36 62.766-63.36 109.692 0 69.894 56.826 126.72 126.72 126.72s126.72-56.826 126.72-126.72c0-31.086-11.286-59.598-29.7-81.576 13.266-9.504 27.522-17.226 39.996-19.206 16.038-2.574 32.868-3.762 50.688-5.148 48.312-3.366 103.158-7.326 148.896-44.55 61.182-49.698 74.25-103.158 75.24-187.902V475.2h-126.72zM316.8 126.72c34.848 0 63.36 28.512 63.36 63.36s-28.512 63.36-63.36 63.36-63.36-28.512-63.36-63.36 28.512-63.36 63.36-63.36zm0 760.32c-34.848 0-63.36-28.512-63.36-63.36s28.512-63.36 63.36-63.36 63.36 28.512 63.36 63.36-28.512 63.36-63.36 63.36zM823.68 158.4h-95.04V63.36h-126.72v95.04h-95.04v126.72h95.04v95.04h126.72v-95.04h95.04z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:none;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:block;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-brands fa-golang" style=""></span><span class="vp-sidebar-title">Go</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fa-solid fa-layer-group" style=""></span><span class="vp-sidebar-title">åŸºç¡€æ¦‚å¿µ</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/basis/log.html" aria-label="MySQLæ—¥å¿—ç³»ç»Ÿè¯¦è§£"><!---->MySQLæ—¥å¿—ç³»ç»Ÿè¯¦è§£<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fa-solid fa-code" style=""></span><span class="vp-sidebar-title">SQL</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/sql/sql%E8%AF%AD%E6%B3%95.html" aria-label="MySQL SQLè¯­æ³•è¯¦è§£"><!---->MySQL SQLè¯­æ³•è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/sql/sql%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.html" aria-label="MySQL SQLæ‰§è¡Œé¡ºåºè¯¦è§£"><!---->MySQL SQLæ‰§è¡Œé¡ºåºè¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/sql/sql%E7%B4%A2%E5%BC%95.html" aria-label="MySQLç´¢å¼•ä½¿ç”¨æŒ‡å—"><!---->MySQLç´¢å¼•ä½¿ç”¨æŒ‡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/sql/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" aria-label="MySQLæ•°æ®ç±»å‹è¯¦è§£"><!---->MySQLæ•°æ®ç±»å‹è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86.html" aria-label="MySQLæ•°æ®åº“ç®¡ç†æŒ‡å—"><!---->MySQLæ•°æ®åº“ç®¡ç†æŒ‡å—<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon fa-fw fa-sm fa-solid fa-gears" style=""></span><span class="vp-sidebar-title">åŸç†</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/principle/%E5%8E%9F%E7%90%86%E5%88%86%E7%B1%BB.html" aria-label="MySQLåŸç†åˆ†ç±»"><!---->MySQLåŸç†åˆ†ç±»<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/principle/%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84.html" aria-label="MySQLé€»è¾‘æ¶æ„è¯¦è§£"><!---->MySQLé€»è¾‘æ¶æ„è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/principle/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html" aria-label="InnoDBå­˜å‚¨å¼•æ“è¯¦è§£"><!---->InnoDBå­˜å‚¨å¼•æ“è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/principle/%E7%B4%A2%E5%BC%95.html" aria-label="MySQLç´¢å¼•åŸç†è¯¦è§£"><!---->MySQLç´¢å¼•åŸç†è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/principle/%E4%BA%8B%E5%8A%A1.html" aria-label="MySQLäº‹åŠ¡æœºåˆ¶è¯¦è§£"><!---->MySQLäº‹åŠ¡æœºåˆ¶è¯¦è§£<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/back-end/mysql/principle/%E9%94%81.html" aria-label="MySQLé”æœºåˆ¶è¯¦è§£"><!---->MySQLé”æœºåˆ¶è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/principle/%E6%97%A5%E5%BF%97.html" aria-label="MySQLæ—¥å¿—ç³»ç»ŸåŸç†è¯¦è§£"><!---->MySQLæ—¥å¿—ç³»ç»ŸåŸç†è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/principle/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98.html" aria-label="MySQLæ€§èƒ½è°ƒä¼˜æŒ‡å—"><!---->MySQLæ€§èƒ½è°ƒä¼˜æŒ‡å—<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fa-solid fa-shield-halved" style=""></span><span class="vp-sidebar-title">é«˜å¯ç”¨</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/High-availability/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8.html" aria-label="MySQLåˆ†åº“åˆ†è¡¨å®è·µ"><!---->MySQLåˆ†åº“åˆ†è¡¨å®è·µ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/back-end/mysql/High-availability/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E3%80%81%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5.html" aria-label="MySQLè¯»å†™åˆ†ç¦»ä¸ä¸»ä»åŒæ­¥è¯¦è§£"><!---->MySQLè¯»å†™åˆ†ç¦»ä¸ä¸»ä»åŒæ­¥è¯¦è§£<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-brands fa-docker" style=""></span><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-message" style=""></span><span class="vp-sidebar-title">Kafka</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-brands fa-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-code" style=""></span><span class="vp-sidebar-title">C++</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-brands fa-linux" style=""></span><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-network-wired" style=""></span><span class="vp-sidebar-title">åˆ†å¸ƒå¼</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-gauge-high" style=""></span><span class="vp-sidebar-title">åç«¯ä¼˜åŒ–åœºæ™¯</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-cubes" style=""></span><span class="vp-sidebar-title">å¾®æœåŠ¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-code-branch" style=""></span><span class="vp-sidebar-title">ç®—æ³•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-globe" style=""></span><span class="vp-sidebar-title">è®¡ç®—æœºç½‘ç»œ</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->MySQLé”æœºåˆ¶è¯¦è§£</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/kryiea" target="_blank" rel="noopener noreferrer">kryiea</a></span><span property="author" content="kryiea"></span></span><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2024å¹´1æœˆ1æ—¥</span><meta property="datePublished" content="2024-01-01T00:00:00.000Z"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color7 clickable" role="navigation">æ•°æ®åº“</span><span class="page-category-item color6 clickable" role="navigation">MySQL</span><!--]--><meta property="articleSection" content="æ•°æ®åº“,MySQL"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color6 clickable" role="navigation">MySQL</span><span class="page-tag-item color0 clickable" role="navigation">é”æœºåˆ¶</span><span class="page-tag-item color2 clickable" role="navigation">å¹¶å‘æ§åˆ¶</span><span class="page-tag-item color3 clickable" role="navigation">æ€§èƒ½ä¼˜åŒ–</span><!--]--><meta property="keywords" content="MySQL,é”æœºåˆ¶,å¹¶å‘æ§åˆ¶,æ€§èƒ½ä¼˜åŒ–"></span><!----></div><hr></div><!----><!----><div class="theme-hope-content" vp-content><p><strong>é”</strong></p><p><strong>MySQL æœ‰å“ªäº›é”ï¼Ÿ</strong></p><p>æ ¹æ®åŠ é”çš„èŒƒå›´ï¼Œå¯ä»¥åˆ†ä¸º <strong>å…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”</strong> ä¸‰ç±»ã€‚</p><ul><li>å…¨å±€é”ï¼š FTWRL</li><li>è¡¨çº§é”ï¼šè¡¨é”ã€å…ƒæ•°æ®é”ã€æ„å‘é”ã€AUTO-INC é”</li><li>è¡Œçº§é”ï¼šRecord Lockã€Gap Lockã€Next-key Lock</li></ul><p><strong>å…¨å±€é”</strong></p><p><strong>å…¨å±€é”ç”¨æ³•</strong></p><p>è¦ä½¿ç”¨å…¨å±€é”ï¼Œåˆ™è¦æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>flush tables with read lock</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ‰§è¡Œåï¼Œ <strong>æ•´ä¸ªæ•°æ®åº“å°±å¤„äºåªè¯»çŠ¶æ€äº†</strong> ï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œéƒ½ä¼šè¢«é˜»å¡ï¼š</p><ul><li>å¯¹æ•°æ®çš„å¢åˆ æ”¹æ“ä½œï¼Œæ¯”å¦‚ insertã€deleteã€updateç­‰è¯­å¥ï¼›</li><li>å¯¹è¡¨ç»“æ„çš„æ›´æ”¹æ“ä½œï¼Œæ¯”å¦‚ alter tableã€drop table ç­‰è¯­å¥ã€‚</li></ul><p>å¦‚æœè¦é‡Šæ”¾å…¨å±€é”ï¼Œåˆ™è¦æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>unlock tables</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ç„¶ï¼Œå½“ä¼šè¯æ–­å¼€äº†ï¼Œå…¨å±€é”ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</p><p><strong>å…¨å±€é”åº”ç”¨åœºæ™¯</strong></p><p>å…¨å±€é”ä¸»è¦åº”ç”¨äºåš <strong>å…¨åº“é€»è¾‘å¤‡ä»½</strong> ï¼Œè¿™æ ·åœ¨å¤‡ä»½æ•°æ®åº“æœŸé—´ï¼Œä¸ä¼šå› ä¸ºæ•°æ®æˆ–è¡¨ç»“æ„çš„æ›´æ–°ï¼Œè€Œå‡ºç°å¤‡ä»½æ–‡ä»¶çš„æ•°æ®ä¸é¢„æœŸçš„ä¸ä¸€æ ·ã€‚</p><p><strong>å…¨å±€é”çš„ç¼ºç‚¹</strong></p><p>åŠ ä¸Šå…¨å±€é”ï¼Œæ„å‘³ç€æ•´ä¸ªæ•°æ®åº“éƒ½æ˜¯åªè¯»çŠ¶æ€ã€‚</p><p>é‚£ä¹ˆå¦‚æœæ•°æ®åº“é‡Œæœ‰å¾ˆå¤šæ•°æ®ï¼Œå¤‡ä»½å°±ä¼šèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´ï¼Œå…³é”®æ˜¯å¤‡ä»½æœŸé—´ï¼Œä¸šåŠ¡åªèƒ½è¯»æ•°æ®ï¼Œè€Œä¸èƒ½æ›´æ–°æ•°æ®ï¼Œè¿™æ ·ä¼šé€ æˆ<strong>ä¸šåŠ¡åœæ»</strong>ã€‚</p><p>é‚£æœ‰ä»€ä¹ˆå…¶ä»–æ–¹å¼å¯ä»¥é¿å…ï¼Ÿ</p><p>æœ‰çš„ï¼Œå¦‚æœæ•°æ®åº“çš„å¼•æ“æ”¯æŒçš„äº‹åŠ¡æ”¯æŒ <strong>å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«</strong> ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æ•°æ®åº“ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ï¼Œä¼šå…ˆåˆ›å»º Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read Viewï¼Œè€Œä¸”ç”±äº MVCC çš„æ”¯æŒï¼Œå¤‡ä»½æœŸé—´ä¸šåŠ¡ä¾ç„¶å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œã€‚</p><p>å› ä¸ºåœ¨å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡æ›´æ–°äº†è¡¨çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“å¤‡ä»½æ•°æ®åº“æ—¶çš„ Read Viewï¼Œè¿™å°±æ˜¯äº‹åŠ¡å››å¤§ç‰¹æ€§ä¸­çš„éš”ç¦»æ€§ï¼Œè¿™æ ·å¤‡ä»½æœŸé—´å¤‡ä»½çš„æ•°æ®ä¸€ç›´æ˜¯åœ¨å¼€å¯äº‹åŠ¡æ—¶çš„æ•°æ®ã€‚</p><p>å¤‡ä»½æ•°æ®åº“çš„å·¥å…·æ˜¯ <strong>mysqldump</strong>ï¼Œåœ¨ä½¿ç”¨ <strong>mysqldump</strong> æ—¶åŠ ä¸Š â€“single-transaction å‚æ•°çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨å¤‡ä»½æ•°æ®åº“ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ã€‚</p><p>è¿™ç§æ–¹æ³•åªé€‚ç”¨äºæ”¯æŒã€Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ã€çš„å­˜å‚¨å¼•æ“ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ­£æ˜¯å¯é‡å¤è¯»ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å¤‡ä»½æ•°æ®åº“ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äº MyISAM è¿™ç§ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œåœ¨å¤‡ä»½æ•°æ®åº“æ—¶å°±è¦ä½¿ç”¨å…¨å±€é”çš„æ–¹æ³•ã€‚</p><p><strong>è¡¨çº§é”</strong></p><p><strong>è¡¨çº§é”ç±»å‹</strong></p><p>MySQL é‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰è¿™å‡ ç§ï¼š</p><ul><li>è¡¨é”ï¼›</li><li>å…ƒæ•°æ®é”ï¼ˆMDL;</li><li>æ„å‘é”ï¼›</li><li>AUTO-INC é”ï¼›</li></ul><p><strong>è¡¨é”</strong></p><p>å¦‚æœæˆ‘ä»¬æƒ³å¯¹å­¦ç”Ÿè¡¨ï¼ˆt_studentï¼‰åŠ è¡¨é”ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">//è¡¨çº§åˆ«çš„å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯è¯»é”ï¼›</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">lock tables t\_student </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">read</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">//è¡¨çº§åˆ«çš„ç‹¬å é”ï¼Œä¹Ÿå°±æ˜¯å†™é”ï¼›</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">lock tables t\_stuent write;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¡¨é”é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿä¼šé™åˆ¶æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„è¯»å†™æ“ä½œ</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ¬çº¿ç¨‹å¯¹å­¦ç”Ÿè¡¨åŠ äº†ã€Œå…±äº«è¡¨é”ã€ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹æ¥ä¸‹æ¥å¦‚æœè¦å¯¹å­¦ç”Ÿè¡¨æ‰§è¡Œå†™æ“ä½œçš„è¯­å¥ï¼Œæ˜¯ä¼šè¢«é˜»å¡çš„ï¼Œå½“ç„¶å…¶ä»–çº¿ç¨‹å¯¹å­¦ç”Ÿè¡¨è¿›è¡Œå†™æ“ä½œæ—¶ä¹Ÿä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p><p>è¦é‡Šæ”¾è¡¨é”ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œä¼šé‡Šæ”¾å½“å‰ä¼šè¯çš„æ‰€æœ‰è¡¨é”ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>unlock tables</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦å¤–ï¼Œå½“ä¼šè¯é€€å‡ºåï¼Œä¹Ÿä¼šé‡Šæ”¾æ‰€æœ‰è¡¨é”ã€‚</p><p>ä¸è¿‡å°½é‡é¿å…åœ¨ä½¿ç”¨ InnoDB å¼•æ“çš„è¡¨ä½¿ç”¨è¡¨é”ï¼Œå› ä¸ºè¡¨é”çš„é¢—ç²’åº¦å¤ªå¤§ï¼Œä¼šå½±å“å¹¶å‘æ€§èƒ½ï¼Œ <strong>InnoDB ç‰›é€¼çš„åœ°æ–¹åœ¨äºå®ç°äº†é¢—ç²’åº¦æ›´ç»†çš„è¡Œçº§é”</strong> ã€‚</p><p><strong>å…ƒæ•°æ®é”</strong></p><p>**å…ƒæ•°æ®ï¼š**æè¿°æ•°æ®åº“ç»“æ„ã€è¡¨ã€åˆ—ã€ç´¢å¼•ç­‰ä¿¡æ¯çš„æ•°æ®</p><p><strong>å…ƒæ•°æ®é”</strong> ï¼ˆMDLï¼‰</p><p>æˆ‘ä»¬ä¸éœ€è¦æ˜¾ç¤ºçš„ä½¿ç”¨ MDLï¼Œå› ä¸ºå½“æˆ‘ä»¬å¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨ç»™è¿™ä¸ªè¡¨åŠ ä¸Š MDLï¼š</p><ul><li>å¯¹ä¸€å¼ è¡¨è¿›è¡Œ CRUD æ“ä½œæ—¶ï¼ŒåŠ çš„æ˜¯ <strong>MDL è¯»é”</strong> ï¼›</li><li>å¯¹ä¸€å¼ è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ çš„æ˜¯ <strong>MDL å†™é”</strong> ï¼›</li></ul><p>MDL æ˜¯ä¸ºäº†ä¿è¯å½“ç”¨æˆ·å¯¹è¡¨æ‰§è¡Œ CRUD æ“ä½œæ—¶ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšäº†å˜æ›´ã€‚</p><p>å½“æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œ select è¯­å¥ï¼ˆ åŠ  MDL è¯»é”ï¼‰çš„æœŸé—´ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è¦æ›´æ”¹è¯¥è¡¨çš„ç»“æ„ï¼ˆ ç”³è¯· MDL å†™é”ï¼‰ï¼Œé‚£ä¹ˆå°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ‰§è¡Œå®Œ select è¯­å¥ï¼ˆ é‡Šæ”¾ MDL è¯»é”ï¼‰ã€‚</p><p>åä¹‹ï¼Œå½“æœ‰çº¿ç¨‹å¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´ï¼ˆ åŠ  MDL å†™é”ï¼‰çš„æœŸé—´ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œäº† CRUD æ“ä½œï¼ˆ ç”³è¯· MDL è¯»é”ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¡¨ç»“æ„å˜æ›´å®Œæˆï¼ˆ é‡Šæ”¾ MDL å†™é”ï¼‰ã€‚</p><p>MDL ä¸éœ€è¦æ˜¾ç¤ºè°ƒç”¨ï¼Œé‚£å®ƒæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™é‡Šæ”¾çš„?</p><p>MDL æ˜¯åœ¨äº‹åŠ¡æäº¤åæ‰ä¼šé‡Šæ”¾ï¼Œè¿™æ„å‘³ç€ <strong>äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒMDL æ˜¯ä¸€ç›´æŒæœ‰çš„</strong> ã€‚</p><p>é‚£å¦‚æœæ•°æ®åº“æœ‰ä¸€ä¸ªé•¿äº‹åŠ¡ï¼ˆæ‰€è°“çš„é•¿äº‹åŠ¡ï¼Œå°±æ˜¯å¼€å¯äº†äº‹åŠ¡ï¼Œä½†æ˜¯ä¸€ç›´è¿˜æ²¡æäº¤ï¼‰ï¼Œé‚£åœ¨å¯¹è¡¨ç»“æ„åšå˜æ›´æ“ä½œçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„äº‹æƒ…ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªé¡ºåºçš„åœºæ™¯ï¼š</p><ol><li>é¦–å…ˆï¼Œçº¿ç¨‹ A å…ˆå¯ç”¨äº†äº‹åŠ¡ï¼ˆä½†æ˜¯ä¸€ç›´ä¸æäº¤ï¼‰ï¼Œç„¶åæ‰§è¡Œä¸€æ¡ select è¯­å¥ï¼Œæ­¤æ—¶å°±å…ˆå¯¹è¯¥è¡¨åŠ ä¸Š MDL è¯»é”ï¼›</li><li>ç„¶åï¼Œçº¿ç¨‹ B ä¹Ÿæ‰§è¡Œäº†åŒæ ·çš„ select è¯­å¥ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šé˜»å¡ï¼Œå› ä¸ºã€Œè¯»è¯»ã€å¹¶ä¸å†²çªï¼›</li><li>æ¥ç€ï¼Œçº¿ç¨‹ C ä¿®æ”¹äº†è¡¨å­—æ®µï¼Œæ­¤æ—¶ç”±äºçº¿ç¨‹ A çš„äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œä¹Ÿå°±æ˜¯ MDL è¯»é”è¿˜åœ¨å ç”¨ç€ï¼Œè¿™æ—¶çº¿ç¨‹ C å°±æ— æ³•ç”³è¯·åˆ° MDL å†™é”ï¼Œå°±ä¼šè¢«é˜»å¡ï¼Œ</li></ol><p>é‚£ä¹ˆåœ¨çº¿ç¨‹ C é˜»å¡åï¼Œåç»­æœ‰å¯¹è¯¥è¡¨çš„ select è¯­å¥ï¼Œå°±éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¤§é‡è¯¥è¡¨çš„ select è¯­å¥çš„è¯·æ±‚åˆ°æ¥ï¼Œå°±ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹è¢«é˜»å¡ä½ï¼Œè¿™æ—¶æ•°æ®åº“çš„çº¿ç¨‹å¾ˆå¿«å°±ä¼šçˆ†æ»¡äº†ã€‚</p><p>ä¸ºä»€ä¹ˆçº¿ç¨‹ C å› ä¸ºç”³è¯·ä¸åˆ° MDL å†™é”ï¼Œè€Œå¯¼è‡´åç»­çš„ç”³è¯·è¯»é”çš„æŸ¥è¯¢æ“ä½œä¹Ÿä¼šè¢«é˜»å¡ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºç”³è¯· MDL é”çš„æ“ä½œä¼šå½¢æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­ <strong>å†™é”è·å–ä¼˜å…ˆçº§é«˜äºè¯»é”</strong> ï¼Œä¸€æ—¦å‡ºç° MDL å†™é”ç­‰å¾…ï¼Œä¼šé˜»å¡åç»­è¯¥è¡¨çš„æ‰€æœ‰ CRUD æ“ä½œã€‚</p><p>æ‰€ä»¥ä¸ºäº†èƒ½å®‰å…¨çš„å¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´ï¼Œåœ¨å¯¹è¡¨ç»“æ„å˜æ›´å‰ï¼Œå…ˆè¦çœ‹çœ‹æ•°æ®åº“ä¸­çš„é•¿äº‹åŠ¡ï¼Œæ˜¯å¦æœ‰äº‹åŠ¡å·²ç»å¯¹è¡¨åŠ ä¸Šäº† MDL è¯»é”ï¼Œå¦‚æœå¯ä»¥è€ƒè™‘ kill æ‰è¿™ä¸ªé•¿äº‹åŠ¡ï¼Œç„¶åå†åšè¡¨ç»“æ„çš„å˜æ›´ã€‚</p><p><strong>æ„å‘é”</strong></p><ul><li>åœ¨ä½¿ç”¨ InnoDB å¼•æ“çš„è¡¨é‡Œå¯¹æŸäº›è®°å½•åŠ ä¸Šã€Œå…±äº«é”ã€ä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šä¸€ä¸ªã€Œæ„å‘å…±äº«é”ã€</li><li>åœ¨ä½¿ç”¨ InnoDB å¼•æ“çš„è¡¨é‡Œå¯¹æŸäº›çºªå½•åŠ ä¸Šã€Œç‹¬å é”ã€ä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šä¸€ä¸ªã€Œæ„å‘ç‹¬å é”ã€</li></ul><p>ä¹Ÿå°±æ˜¯ï¼Œå½“æ‰§è¡Œæ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦å…ˆå¯¹è¡¨åŠ ä¸Šã€Œæ„å‘ç‹¬å é”ã€ï¼Œç„¶åå¯¹è¯¥è®°å½•åŠ ç‹¬å é”ã€‚</p><p>è€Œæ™®é€šçš„ select æ˜¯ä¸ä¼šåŠ è¡Œçº§é”çš„ï¼Œæ™®é€šçš„ select è¯­å¥æ˜¯åˆ©ç”¨ MVCC å®ç°ä¸€è‡´æ€§è¯»ï¼Œæ˜¯æ— é”çš„ã€‚</p><p>ä¸è¿‡ï¼Œselect ä¹Ÿæ˜¯å¯ä»¥å¯¹è®°å½•åŠ å…±äº«é”å’Œç‹¬å é”çš„ï¼Œå…·ä½“æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//å…ˆåœ¨è¡¨ä¸ŠåŠ ä¸Šæ„å‘å…±äº«é”ï¼Œç„¶åå¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”</span></span>
<span class="line"><span>select ... lock in share mode;</span></span>
<span class="line"><span>//å…ˆè¡¨ä¸ŠåŠ ä¸Šæ„å‘ç‹¬å é”ï¼Œç„¶åå¯¹è¯»å–çš„è®°å½•åŠ ç‹¬å é”</span></span>
<span class="line"><span>select ... for update;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ„å‘å…±äº«é”å’Œæ„å‘ç‹¬å é”æ˜¯è¡¨çº§é”ï¼Œä¸ä¼šå’Œè¡Œçº§çš„å…±äº«é”å’Œç‹¬å é”å‘ç”Ÿå†²çªï¼Œè€Œä¸”æ„å‘é”ä¹‹é—´ä¹Ÿä¸ä¼šå‘ç”Ÿå†²çªï¼Œåªä¼šå’Œå…±äº«è¡¨é”ï¼ˆ <em>lock tables ... read</em> ï¼‰å’Œç‹¬å è¡¨é”ï¼ˆ <em>lock tables ... write</em> ï¼‰å‘ç”Ÿå†²çªã€‚</strong></p><p>è¡¨é”å’Œè¡Œé”æ˜¯æ»¡è¶³è¯»è¯»å…±äº«ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥çš„ã€‚</p><p>å¦‚æœæ²¡æœ‰ã€Œæ„å‘é”ã€ï¼Œé‚£ä¹ˆåŠ ã€Œç‹¬å è¡¨é”ã€æ—¶ï¼Œå°±éœ€è¦éå†è¡¨é‡Œæ‰€æœ‰è®°å½•ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è®°å½•å­˜åœ¨ç‹¬å é”ï¼Œè¿™æ ·æ•ˆç‡ä¼šå¾ˆæ…¢ã€‚</p><p>é‚£ä¹ˆæœ‰äº†ã€Œæ„å‘é”ã€ï¼Œç”±äºåœ¨å¯¹è®°å½•åŠ ç‹¬å é”å‰ï¼Œå…ˆä¼šåŠ ä¸Šè¡¨çº§åˆ«çš„æ„å‘ç‹¬å é”ï¼Œé‚£ä¹ˆåœ¨åŠ ã€Œç‹¬å è¡¨é”ã€æ—¶ï¼Œç›´æ¥æŸ¥è¯¥è¡¨æ˜¯å¦æœ‰æ„å‘ç‹¬å é”ï¼Œå¦‚æœæœ‰å°±æ„å‘³ç€è¡¨é‡Œå·²ç»æœ‰è®°å½•è¢«åŠ äº†ç‹¬å é”ï¼Œè¿™æ ·å°±ä¸ç”¨å»éå†è¡¨é‡Œçš„è®°å½•ã€‚</p><p><strong>æ„å‘é”çš„ç›®çš„æ˜¯ä¸ºäº†å¿«é€Ÿåˆ¤æ–­è¡¨é‡Œæ˜¯å¦æœ‰è®°å½•è¢«åŠ é”</strong> ã€‚</p><p><strong>AUTO-INC é”</strong></p><p>AUTO-INC é”æ˜¯ç‰¹æ®Šçš„è¡¨é”æœºåˆ¶ï¼š<strong>é”ä¸æ˜¯åœ¨ ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰é‡Šæ”¾ï¼Œè€Œæ˜¯å†æ‰§è¡Œå®Œæ’å…¥è¯­å¥åå°±ä¼šç«‹å³é‡Šæ”¾</strong> ã€‚</p><p>è¡¨é‡Œçš„ä¸»é”®é€šå¸¸éƒ½ä¼šè®¾ç½®æˆè‡ªå¢çš„ï¼Œè¿™æ˜¯é€šè¿‡å¯¹ä¸»é”®å­—æ®µå£°æ˜ AUTO_INCREMENT å±æ€§å®ç°çš„ã€‚</p><p>ä¹‹åå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šä¸»é”®çš„å€¼ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ç»™ä¸»é”®èµ‹å€¼é€’å¢çš„å€¼ï¼Œè¿™ä¸»è¦æ˜¯é€šè¿‡ <strong>AUTO-INC é”</strong> å®ç°çš„ã€‚</p><p><strong>åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šåŠ ä¸€ä¸ªè¡¨çº§åˆ«çš„ AUTO-INC é”</strong> ï¼Œç„¶åä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µèµ‹å€¼é€’å¢çš„å€¼ï¼Œç­‰æ’å…¥è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šæŠŠ AUTO-INC é”é‡Šæ”¾æ‰ã€‚</p><p>é‚£ä¹ˆï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„å¦‚æœè¦å‘è¯¥è¡¨æ’å…¥è¯­å¥éƒ½ä¼šè¢«é˜»å¡ï¼Œä»è€Œä¿è¯æ’å…¥æ•°æ®æ—¶ï¼Œè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µçš„å€¼æ˜¯è¿ç»­é€’å¢çš„ã€‚</p><p>ä½†æ˜¯ï¼Œ AUTO-INC é”å†å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œä¼šå½±å“æ’å…¥æ€§èƒ½ï¼Œå› ä¸ºå¦ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ’å…¥ä¼šè¢«é˜»å¡ã€‚</p><p>è½»é‡çº§é”</p><p>åœ¨ MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸€ç§ <strong>è½»é‡çº§çš„é”</strong> æ¥å®ç°è‡ªå¢ã€‚</p><p>ä¸€æ ·ä¹Ÿæ˜¯åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¼šä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µåŠ ä¸Šè½»é‡çº§é”ï¼Œ <strong>ç„¶åç»™è¯¥å­—æ®µèµ‹å€¼ä¸€ä¸ªè‡ªå¢çš„å€¼ï¼Œå°±æŠŠè¿™ä¸ªè½»é‡çº§é”é‡Šæ”¾äº†ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ’å…¥è¯­å¥æ‰§è¡Œå®Œåæ‰é‡Šæ”¾é”</strong> ã€‚</p><p>å‚æ•°æ§åˆ¶ inc é” or è½»é‡çº§é”</p><p>InnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸ª innodb_autoinc_lock_mode çš„ç³»ç»Ÿå˜é‡ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶é€‰æ‹©ç”¨ AUTO-INC é”ï¼Œè¿˜æ˜¯è½»é‡çº§çš„é”ã€‚</p><ul><li>å½“ innodb_autoinc_lock_mode = 0ï¼Œå°±é‡‡ç”¨ AUTO-INC é”ï¼Œè¯­å¥æ‰§è¡Œç»“æŸåæ‰é‡Šæ”¾é”ï¼›</li><li>å½“ innodb_autoinc_lock_mode = 2ï¼Œå°±é‡‡ç”¨è½»é‡çº§é”ï¼Œç”³è¯·è‡ªå¢ä¸»é”®åå°±é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰è¯­å¥æ‰§è¡Œåæ‰é‡Šæ”¾ã€‚</li><li>å½“ innodb_autoinc_lock_mode = 1ï¼š</li><li>æ™®é€š insert è¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾ï¼›</li><li>ç±»ä¼¼ insert â€¦ select è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾ï¼›</li></ul><p>å½“ innodb_autoinc_lock_mode = 2 æ˜¯æ€§èƒ½æœ€é«˜çš„æ–¹å¼ï¼Œä½†æ˜¯å½“æ­é… binlog çš„æ—¥å¿—æ ¼å¼æ˜¯ statement ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œåœ¨ã€Œä¸»ä»å¤åˆ¶çš„åœºæ™¯ã€ä¸­ä¼šå‘ç”Ÿ <strong>æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</strong> ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸‹é¢åœºæ™¯ï¼š</p><p>session A å¾€è¡¨ t ä¸­æ’å…¥äº† 4 è¡Œæ•°æ®ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªç›¸åŒç»“æ„çš„è¡¨ t2ï¼Œç„¶å <strong>ä¸¤ä¸ª session åŒæ—¶æ‰§è¡Œå‘è¡¨ t2 ä¸­æ’å…¥æ•°æ®</strong> ã€‚</p><p>å¦‚æœ innodb_autoinc_lock_mode = 2ï¼Œæ„å‘³ç€ã€Œç”³è¯·è‡ªå¢ä¸»é”®åå°±é‡Šæ”¾é”ï¼Œä¸å¿…ç­‰æ’å…¥è¯­å¥æ‰§è¡Œå®Œã€ã€‚é‚£ä¹ˆå°±å¯èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µï¼š</p><ul><li>session B å…ˆæ’å…¥äº†ä¸¤ä¸ªè®°å½•ï¼Œ(1,1,1)ã€(2,2,2)ï¼›</li><li>ç„¶åï¼Œsession A æ¥ç”³è¯·è‡ªå¢ id å¾—åˆ° id=3ï¼Œæ’å…¥äº†ï¼ˆ3,5,5)ï¼›</li><li>ä¹‹åï¼Œsession B ç»§ç»­æ‰§è¡Œï¼Œæ’å…¥ä¸¤æ¡è®°å½• (4,3,3)ã€ (5,4,4)ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ <strong>session B çš„ insert è¯­å¥ï¼Œç”Ÿæˆçš„ id ä¸è¿ç»­</strong> ã€‚</p><p>å½“ã€Œä¸»åº“ã€å‘ç”Ÿäº†è¿™ç§æƒ…å†µï¼Œbinlog é¢å¯¹ t2 è¡¨çš„æ›´æ–°åªä¼šè®°å½•è¿™ä¸¤ä¸ª session çš„ insert è¯­å¥ï¼Œå¦‚æœ binlog_format=statementï¼Œè®°å½•çš„è¯­å¥å°±æ˜¯åŸå§‹è¯­å¥ã€‚è®°å½•çš„é¡ºåºè¦ä¹ˆå…ˆè®° session A çš„ insert è¯­å¥ï¼Œè¦ä¹ˆå…ˆè®° session B çš„ insert è¯­å¥ã€‚</p><p>ä½†ä¸è®ºæ˜¯å“ªä¸€ç§ï¼Œè¿™ä¸ª binlog æ‹¿å»ã€Œä»åº“ã€æ‰§è¡Œï¼Œè¿™æ—¶ä»åº“æ˜¯æŒ‰ã€Œé¡ºåºã€æ‰§è¡Œè¯­å¥çš„ï¼Œåªæœ‰å½“æ‰§è¡Œå®Œä¸€æ¡ SQL è¯­å¥åï¼Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€æ¡ SQLã€‚å› æ­¤ï¼Œåœ¨ <strong>ä»åº“ä¸Šã€Œä¸ä¼šã€å‘ç”Ÿåƒä¸»åº“é‚£æ ·ä¸¤ä¸ª session ã€ŒåŒæ—¶ã€æ‰§è¡Œå‘è¡¨ t2 ä¸­æ’å…¥æ•°æ®çš„åœºæ™¯ã€‚æ‰€ä»¥ï¼Œåœ¨å¤‡åº“ä¸Šæ‰§è¡Œäº† session B çš„ insert è¯­å¥ï¼Œç”Ÿæˆçš„ç»“æœé‡Œé¢ï¼Œid éƒ½æ˜¯è¿ç»­çš„ã€‚è¿™æ—¶ï¼Œä¸»ä»åº“å°±å‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´</strong> ã€‚</p><p>è¦è§£å†³è¿™é—®é¢˜ï¼Œbinlog æ—¥å¿—æ ¼å¼è¦è®¾ç½®ä¸º rowï¼Œè¿™æ ·åœ¨ binlog é‡Œé¢è®°å½•çš„æ˜¯ä¸»åº“åˆ†é…çš„è‡ªå¢å€¼ï¼Œåˆ°å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸»åº“çš„è‡ªå¢å€¼æ˜¯ä»€ä¹ˆï¼Œä»åº“çš„è‡ªå¢å€¼å°±æ˜¯ä»€ä¹ˆã€‚</p><p>æ‰€ä»¥ï¼Œ <strong>å½“ innodb_autoinc_lock_mode = 2 æ—¶ï¼Œå¹¶ä¸” binlog_format = rowï¼Œæ—¢èƒ½æå‡å¹¶å‘æ€§ï¼Œåˆä¸ä¼šå‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong> ã€‚</p><p><strong>è¡Œçº§é”</strong></p><p><strong>InnoDB å¼•æ“æ˜¯æ”¯æŒè¡Œçº§é”çš„ï¼Œè€Œ MyISAM å¼•æ“å¹¶ä¸æ”¯æŒè¡Œçº§é”</strong></p><p>å‰é¢ä¹Ÿæåˆ°ï¼Œæ™®é€šçš„ select è¯­å¥æ˜¯ä¸ä¼šå¯¹è®°å½•åŠ é”çš„ï¼Œå› ä¸ºå®ƒå±äºå¿«ç…§è¯»ã€‚</p><p>å¦‚æœè¦åœ¨æŸ¥è¯¢æ—¶å¯¹è®°å½•åŠ è¡Œé”ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸¤ä¸ªæ–¹å¼ï¼Œè¿™ç§æŸ¥è¯¢ä¼šåŠ é”çš„è¯­å¥ç§°ä¸º <strong>é”å®šè¯»</strong> ã€‚</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”</span></span>
<span class="line"><span>select ... lock in share mode;</span></span>
<span class="line"><span>//å¯¹è¯»å–çš„è®°å½•åŠ ç‹¬å é”</span></span>
<span class="line"><span>select ... for update;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸Šé¢è¿™ä¸¤æ¡è¯­å¥å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œ å› ä¸ºå½“äº‹åŠ¡æäº¤äº†ï¼Œé”å°±ä¼šè¢«é‡Šæ”¾</strong> ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¿™ä¸¤æ¡è¯­å¥çš„æ—¶å€™ï¼Œè¦åŠ ä¸Š beginã€start transaction æˆ–è€… set autocommit = 0ã€‚</p><p>å…±äº«é”ï¼ˆSé”ï¼‰æ»¡è¶³è¯»è¯»å…±äº«ï¼Œè¯»å†™äº’æ–¥ã€‚</p><p>ç‹¬å é”ï¼ˆXé”ï¼‰æ»¡è¶³å†™å†™äº’æ–¥ã€è¯»å†™äº’æ–¥ã€‚</p><p>è¡Œçº§é”çš„ç±»å‹ä¸»è¦æœ‰ä¸‰ç±»ï¼š</p><ul><li>Record Lockï¼Œè®°å½•é”ï¼Œä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ä¸Šï¼›</li><li>Gap Lockï¼Œé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†æ˜¯ä¸åŒ…å«è®°å½•æœ¬èº«ï¼›</li><li>Next-Key Lockï¼šRecord Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</li></ul><p><strong>Record Lock</strong></p><p><strong>Record Lock ç§°ä¸ºè®°å½•é”ï¼Œé”ä½çš„æ˜¯ä¸€æ¡è®°å½•ã€‚è€Œä¸”è®°å½•é”æ˜¯æœ‰ S é”å’Œ X é”ä¹‹åˆ†çš„ï¼š</strong></p><figure><img src="/assets/%E9%94%81.001-DN4g-5De.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><ul><li>å½“ä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€æ¡è®°å½•åŠ äº† S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­å¯¹è¯¥è®°å½•åŠ  S å‹è®°å½•é”ï¼ˆS å‹ä¸ S é”å…¼å®¹ï¼‰ï¼Œä½†æ˜¯ä¸å¯ä»¥å¯¹è¯¥è®°å½•åŠ  X å‹è®°å½•é”ï¼ˆS å‹ä¸ X é”ä¸å…¼å®¹ï¼‰;</li><li>å½“ä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€æ¡è®°å½•åŠ äº† X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥å¯¹è¯¥è®°å½•åŠ  S å‹è®°å½•é”ï¼ˆS å‹ä¸ X é”ä¸å…¼å®¹ï¼‰ï¼Œä¹Ÿä¸å¯ä»¥å¯¹è¯¥è®°å½•åŠ  X å‹è®°å½•é”ï¼ˆX å‹ä¸ X é”ä¸å…¼å®¹ï¼‰ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­</p><p>å½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œäº†ä¸‹é¢è¿™æ¡è¯­å¥ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mysql &gt; begin;</span></span>
<span class="line"><span>mysql &gt; select \* from t\_test where id = 1 for update;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å°±æ˜¯å¯¹ t_test è¡¨ä¸­ä¸»é”® id ä¸º 1 çš„è¿™æ¡è®°å½•åŠ ä¸Š X å‹çš„è®°å½•é”ï¼Œè¿™æ ·å…¶ä»–äº‹åŠ¡å°±æ— æ³•å¯¹è¿™æ¡è®°å½•è¿›è¡Œä¿®æ”¹äº†ã€‚</p><p>å½“äº‹åŠ¡æ‰§è¡Œ commit åï¼Œäº‹åŠ¡è¿‡ç¨‹ä¸­ç”Ÿæˆçš„é”éƒ½ä¼šè¢«é‡Šæ”¾ã€‚</p><p><strong>Gap Lock</strong></p><p><strong>Gap Lock ç§°ä¸ºé—´éš™é”ï¼Œåªå­˜åœ¨äºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œç›®çš„æ˜¯ä¸ºäº†è§£å†³å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¹»è¯»çš„ç°è±¡ã€‚</strong></p><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5ï¼‰é—´éš™é”ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å°±æ— æ³•æ’å…¥ id = 4 è¿™æ¡è®°å½•äº†ï¼Œè¿™æ ·å°±æœ‰æ•ˆçš„é˜²æ­¢å¹»è¯»ç°è±¡çš„å‘ç”Ÿã€‚</p><p>é—´éš™é”è™½ç„¶å­˜åœ¨ X å‹é—´éš™é”å’Œ S å‹é—´éš™é”ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œ <strong>é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå¹¶ä¸å­˜åœ¨äº’æ–¥å…³ç³»ï¼Œå› ä¸ºé—´éš™é”çš„ç›®çš„æ˜¯é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„</strong> ã€‚</p><p><strong>Next-Key Lock</strong></p><p><strong>Next-Key Lock ç§°ä¸ºä¸´é”®é”ï¼Œæ˜¯ Record Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</strong></p><p><strong>é”ä¸Šç•Œï¼Œä¸é”ä¸‹ç•Œï¼ˆï¼Ÿï¼Œï¼Ÿ]</strong></p><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5] çš„ next-key lockï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å³ä¸èƒ½æ’å…¥ id = 4 è®°å½•ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹ id = 5 è¿™æ¡è®°å½•ã€‚</p><p>æ‰€ä»¥ï¼Œnext-key lock å³èƒ½ä¿æŠ¤è¯¥è®°å½•ï¼Œåˆèƒ½é˜»æ­¢å…¶ä»–äº‹åŠ¡å°†æ–°çºªå½•æ’å…¥åˆ°è¢«ä¿æŠ¤è®°å½•å‰é¢çš„é—´éš™ä¸­ã€‚</p><p>å…¼å®¹é—®é¢˜</p><p><strong>next-key lock æ˜¯åŒ…å«é—´éš™é”+è®°å½•é”çš„ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº† X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ç›¸åŒèŒƒå›´çš„ X å‹çš„ next-key lock æ—¶ï¼Œæ˜¯ä¼šè¢«é˜»å¡çš„</strong> ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡æŒæœ‰äº†èŒƒå›´ä¸º (1, 10] çš„ X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ç›¸åŒèŒƒå›´çš„ X å‹çš„ next-key lock æ—¶ï¼Œå°±ä¼šè¢«é˜»å¡ã€‚</p><p>è™½ç„¶ç›¸åŒèŒƒå›´çš„é—´éš™é”æ˜¯å¤šä¸ªäº‹åŠ¡ç›¸äº’å…¼å®¹çš„ï¼Œä½†å¯¹äºè®°å½•é”ï¼Œæˆ‘ä»¬æ˜¯è¦è€ƒè™‘ X å‹ä¸ S å‹å…³ç³»ï¼ŒX å‹çš„è®°å½•é”ä¸ X å‹çš„è®°å½•é”æ˜¯å†²çªçš„ã€‚</p><p><strong>æ’å…¥æ„å‘é” ï¼ˆä¸æ˜¯æ„å‘é”ï¼‰</strong></p><p><strong>ä¸€ä¸ªäº‹åŠ¡åœ¨æ’å…¥ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­æ’å…¥ä½ç½®æ˜¯å¦å·²è¢«å…¶ä»–äº‹åŠ¡åŠ äº†é—´éš™é”ï¼ˆnext-key lock ä¹ŸåŒ…å«é—´éš™é”ï¼‰ã€‚</strong></p><p>æ’å…¥æ„å‘é”åå­—è™½ç„¶æœ‰æ„å‘é”ï¼Œä½†æ˜¯å®ƒå¹¶ <strong>ä¸æ˜¯æ„å‘é”ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œå±äºè¡Œçº§åˆ«é”</strong> ã€‚</p><p>å¦‚æœæœ‰çš„è¯ï¼Œæ’å…¥æ“ä½œå°±ä¼šå‘ç”Ÿ <strong>é˜»å¡</strong> ï¼Œç›´åˆ°æ‹¥æœ‰é—´éš™é”çš„é‚£ä¸ªäº‹åŠ¡æäº¤ä¸ºæ­¢ï¼ˆé‡Šæ”¾é—´éš™é”çš„æ—¶åˆ»ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ä¼šç”Ÿæˆä¸€ä¸ª <strong>æ’å…¥æ„å‘é”</strong> ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ªåŒºé—´æ’å…¥æ–°è®°å½•ï¼Œä½†æ˜¯ç°åœ¨å¤„äºç­‰å¾…çŠ¶æ€ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾äº‹åŠ¡ A å·²ç»å¯¹è¡¨åŠ äº†ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5ï¼‰é—´éš™é”ã€‚</p><p>å½“äº‹åŠ¡ A è¿˜æ²¡æäº¤çš„æ—¶å€™ï¼Œäº‹åŠ¡ B å‘è¯¥è¡¨æ’å…¥ä¸€æ¡ id = 4 çš„æ–°è®°å½•ï¼Œè¿™æ—¶ä¼šåˆ¤æ–­åˆ°æ’å…¥çš„ä½ç½®å·²ç»è¢«äº‹åŠ¡ A åŠ äº†é—´éš™é”ï¼Œäºæ˜¯äº‹ç‰© B ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åå°†é”çš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆ <em>PSï¼šMySQL åŠ é”æ—¶ï¼Œæ˜¯å…ˆç”Ÿæˆé”ç»“æ„ï¼Œç„¶åè®¾ç½®é”çš„çŠ¶æ€ï¼Œå¦‚æœé”çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼Œåªæœ‰å½“é”çŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€æ—¶ï¼Œæ‰ä»£è¡¨äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”</em> ï¼‰ï¼Œæ­¤æ—¶äº‹åŠ¡ B å°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤äº†äº‹åŠ¡ã€‚</p><p>å¦‚æœè¯´é—´éš™é”é”ä½çš„æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œé‚£ä¹ˆã€Œæ’å…¥æ„å‘é”ã€é”ä½çš„å°±æ˜¯ä¸€ä¸ªç‚¹ã€‚å› è€Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œæ’å…¥æ„å‘é”ç¡®å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ã€‚</p><p>æ’å…¥æ„å‘é”ä¸é—´éš™é”çš„å¦ä¸€ä¸ªéå¸¸é‡è¦çš„å·®åˆ«æ˜¯ï¼šå°½ç®¡ã€Œæ’å…¥æ„å‘é”ã€ä¹Ÿå±äºé—´éš™é”ï¼Œä½†ä¸¤ä¸ªäº‹åŠ¡å´ä¸èƒ½åœ¨åŒä¸€æ—¶é—´å†…ï¼Œä¸€ä¸ªæ‹¥æœ‰é—´éš™é”ï¼Œå¦ä¸€ä¸ªæ‹¥æœ‰è¯¥é—´éš™åŒºé—´å†…çš„æ’å…¥æ„å‘é”ï¼ˆå½“ç„¶ï¼Œæ’å…¥æ„å‘é”å¦‚æœä¸åœ¨é—´éš™é”åŒºé—´å†…åˆ™æ˜¯å¯ä»¥çš„ï¼‰ã€‚</p><p><strong>åŠ é”</strong></p><p><strong>ä»€ä¹ˆ sql ä¼šåŠ é”</strong></p><p>é€šçš„ select è¯­å¥æ˜¯ä¸ä¼šå¯¹è®°å½•åŠ é”çš„ï¼Œå› ä¸ºå®ƒå±äºå¿«ç…§è¯»ï¼Œæ˜¯é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å®ç°çš„ã€‚</p><p>å¦‚æœè¦åœ¨æŸ¥è¯¢æ—¶å¯¹è®°å½•åŠ è¡Œçº§é”ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸¤ä¸ªæ–¹å¼ï¼Œè¿™ä¸¤ç§æŸ¥è¯¢ä¼šåŠ é”çš„è¯­å¥ç§°ä¸º <strong>é”å®šè¯»</strong></p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”(Så‹é”)</span></span>
<span class="line"><span>select ... lock in share mode;</span></span>
<span class="line"><span>//å¯¹è¯»å–çš„è®°å½•åŠ ç‹¬å é”(Xå‹é”)</span></span>
<span class="line"><span>select ... for update;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ€ä¹ˆåŠ è¡Œçº§é”</strong></p><p>è¡Œçº§é”åŠ é”è§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œä¸åŒçš„åœºæ™¯ï¼ŒåŠ é”çš„å½¢å¼æ˜¯ä¸åŒçš„ã€‚</p><p><strong>åŠ é”å¯¹è±¡æ˜¯ ç´¢å¼•</strong></p><p><strong>åŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lockï¼Œnext-key lock æ˜¯å‰å¼€åé—­åŒºé—´</strong></p><p>next-key lock åœ¨ä¸€äº›åœºæ™¯ä¸‹ä¼šé€€åŒ–æˆè®°å½•é”æˆ–é—´éš™é”</p><p><strong>åœ¨èƒ½ä½¿ç”¨è®°å½•é”æˆ–è€…é—´éš™é”å°±èƒ½é¿å…å¹»è¯»ç°è±¡çš„åœºæ™¯ä¸‹ï¼Œ next-key lock å°±ä¼šé€€åŒ–æˆé€€åŒ–æˆè®°å½•é”æˆ–é—´éš™é”</strong></p><p><strong>å”¯ä¸€ç´¢å¼• ç­‰å€¼æŸ¥è¯¢</strong></p><p>ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„æ—¶å€™ï¼ŒæŸ¥è¯¢çš„è®°å½•å­˜ä¸å­˜åœ¨ï¼ŒåŠ é”çš„è§„åˆ™ä¹Ÿä¼šä¸åŒï¼š</p><ul><li>å½“æŸ¥è¯¢çš„è®°å½•æ˜¯ã€Œå­˜åœ¨ã€çš„ï¼Œåœ¨ç´¢å¼•æ ‘ä¸Šå®šä½åˆ°è¿™ä¸€æ¡è®°å½•åï¼Œå°†è¯¥è®°å½•çš„ç´¢å¼•ä¸­çš„ next-key lock ä¼š <strong>é€€åŒ–æˆã€Œè®°å½•é”ã€</strong> ã€‚</li><li>å½“æŸ¥è¯¢çš„è®°å½•æ˜¯ã€Œä¸å­˜åœ¨ã€çš„ï¼Œåœ¨ç´¢å¼•æ ‘æ‰¾åˆ°ç¬¬ä¸€æ¡å¤§äºè¯¥æŸ¥è¯¢è®°å½•çš„è®°å½•åï¼Œå°†è¯¥è®°å½•çš„ç´¢å¼•ä¸­çš„ next-key lock ä¼š <strong>é€€åŒ–æˆã€Œé—´éš™é”ã€</strong> ã€‚</li></ul><ol><li><strong>è®°å½•å­˜åœ¨çš„æƒ…å†µ</strong></li></ol><p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œäº†è¿™æ¡ç­‰å€¼æŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥è¯¢çš„è®°å½•æ˜¯ã€Œå­˜åœ¨ã€äºè¡¨ä¸­çš„ã€‚</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mysql&gt; begin;</span></span>
<span class="line"><span>Query OK, 0 rows affected (0.00 sec)</span></span>
<span class="line"><span>mysql&gt; select \* from user where id = 1 for update;</span></span>
<span class="line"><span>+----+--------+-----+</span></span>
<span class="line"><span>| id | name   | age |</span></span>
<span class="line"><span>+----+--------+-----+</span></span>
<span class="line"><span>|  1 | è·¯é£   |  19 |</span></span>
<span class="line"><span>+----+--------+-----+</span></span>
<span class="line"><span>1 row in set (0.02 sec)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆï¼Œäº‹åŠ¡ A ä¼šä¸º id ä¸º 1 çš„è¿™æ¡è®°å½•å°±ä¼šåŠ ä¸Š <strong>X å‹çš„è®°å½•é”</strong> ã€‚</p><figure><img src="/assets/%E9%94%81.002-BDZewAtb.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä¸ºä»€ä¹ˆå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢å¹¶ä¸”æŸ¥è¯¢è®°å½•å­˜åœ¨çš„åœºæ™¯ä¸‹ï¼Œè¯¥è®°å½•çš„ç´¢å¼•ä¸­çš„ next-key lock ä¼šé€€åŒ–æˆè®°å½•é”ï¼Ÿ</p><p>åŸå› å°±æ˜¯åœ¨å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢å¹¶ä¸”æŸ¥è¯¢è®°å½•å­˜åœ¨çš„åœºæ™¯ä¸‹ï¼Œä»…é è®°å½•é”ä¹Ÿèƒ½é¿å…å¹»è¯»çš„é—®é¢˜ã€‚</p><ul><li>ç”±äºä¸»é”®å…·æœ‰å”¯ä¸€æ€§ï¼Œæ‰€ä»¥ å…¶ä»–äº‹åŠ¡æ’å…¥ id = 1 çš„æ—¶å€™ï¼Œä¼šå› ä¸ºä¸»é”®å†²çªï¼Œå¯¼è‡´æ— æ³•æ’å…¥ id = 1 çš„æ–°è®°å½• ã€‚è¿™æ ·äº‹åŠ¡ A åœ¨å¤šæ¬¡æŸ¥è¯¢ id = 1 çš„è®°å½•çš„æ—¶å€™ï¼Œä¸ä¼šå‡ºç°å‰åä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœé›†ä¸åŒï¼Œä¹Ÿå°±é¿å…äº†å¹»è¯»çš„é—®é¢˜ã€‚</li><li>ç”±äºå¯¹ id = 1 åŠ äº†è®°å½•é”ï¼Œ å…¶ä»–äº‹åŠ¡æ— æ³•åˆ é™¤è¯¥è®°å½• ï¼Œè¿™æ ·äº‹åŠ¡ A åœ¨å¤šæ¬¡æŸ¥è¯¢ id = 1 çš„è®°å½•çš„æ—¶å€™ï¼Œä¸ä¼šå‡ºç°å‰åä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœé›†ä¸åŒï¼Œä¹Ÿå°±é¿å…äº†å¹»è¯»çš„é—®é¢˜ã€‚</li></ul><ol><li><strong>è®°å½•ä¸å­˜åœ¨çš„æƒ…å†µ</strong></li></ol><p>å‡è®¾äº‹åŠ¡ A æ‰§è¡Œäº†è¿™æ¡ç­‰å€¼æŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥è¯¢çš„è®°å½•æ˜¯ã€Œä¸å­˜åœ¨ã€äºè¡¨ä¸­çš„ã€‚</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mysql&gt; begin;</span></span>
<span class="line"><span>Query OK, 0 rows affected (0.00 sec)</span></span>
<span class="line"><span>mysql&gt; select \* from user where id = 2 for update;</span></span>
<span class="line"><span>Empty set (0.03 sec)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡select * from performance_schema.data_locks\G; è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡æ‰§è¡Œ SQL è¿‡ç¨‹ä¸­åŠ äº†ä»€ä¹ˆé”ã€‚</p><figure><img src="/assets/%E9%94%81.003-DasfJ51S.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå…±åŠ äº†ä¸¤ä¸ªé”ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>è¡¨é”ï¼šX ç±»å‹çš„æ„å‘é”ï¼›</li><li>è¡Œé”ï¼šX ç±»å‹çš„é—´éš™é”ï¼›</li></ul><p>å› æ­¤ï¼Œ <strong>æ­¤æ—¶äº‹åŠ¡ A åœ¨ id = 5 è®°å½•çš„ä¸»é”®ç´¢å¼•ä¸ŠåŠ çš„æ˜¯é—´éš™é”ï¼Œé”ä½çš„èŒƒå›´æ˜¯ (1, 5)ã€‚</strong></p><figure><img src="/assets/%E9%94%81.004-Dp0I_nXr.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>é—´éš™é”çš„èŒƒå›´ (1, 5) ï¼Œæ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Ÿ</p><p>å¦‚æœ LOCK_MODE æ˜¯ next-key é”æˆ–è€…é—´éš™é”ï¼Œé‚£ä¹ˆ LOCK_DATA å°±è¡¨ç¤ºé”çš„èŒƒå›´ã€Œå³è¾¹ç•Œã€ï¼Œæ­¤æ¬¡çš„äº‹åŠ¡ A çš„ LOCK_DATA æ˜¯ 5ã€‚</p><p>ç„¶åé”èŒƒå›´çš„ã€Œå·¦è¾¹ç•Œã€æ˜¯è¡¨ä¸­ id ä¸º 5 çš„ä¸Šä¸€æ¡è®°å½•çš„ id å€¼ï¼Œå³ 1ã€‚</p><p>å› æ­¤ï¼Œé—´éš™é”çš„èŒƒå›´ (1, 5) ã€‚</p><p><strong>å”¯ä¸€ç´¢å¼• èŒƒå›´æŸ¥è¯¢</strong></p><p>èŒƒå›´æŸ¥è¯¢å’Œç­‰å€¼æŸ¥è¯¢çš„åŠ é”è§„åˆ™æ˜¯ä¸åŒçš„ã€‚</p><p>å½“å”¯ä¸€ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œ ä¼šå¯¹æ¯ä¸€ä¸ªæ‰«æåˆ°çš„ç´¢å¼•åŠ  next-key é”ï¼Œç„¶åå¦‚æœé‡åˆ°ä¸‹é¢è¿™äº›æƒ…å†µï¼Œä¼šé€€åŒ–æˆè®°å½•é”æˆ–è€…é—´éš™é” ï¼š</p><ul><li>æƒ…å†µä¸€ï¼šé’ˆå¯¹ã€Œå¤§äºç­‰äºã€çš„èŒƒå›´æŸ¥è¯¢ï¼Œå› ä¸ºå­˜åœ¨ç­‰å€¼æŸ¥è¯¢çš„æ¡ä»¶ï¼Œé‚£ä¹ˆå¦‚æœç­‰å€¼æŸ¥è¯¢çš„è®°å½•æ˜¯å­˜åœ¨äºè¡¨ä¸­ï¼Œé‚£ä¹ˆè¯¥è®°å½•çš„ç´¢å¼•ä¸­çš„ next-key é”ä¼š é€€åŒ–æˆè®°å½•é” ã€‚</li><li>æƒ…å†µäºŒï¼šé’ˆå¯¹ã€Œå°äºæˆ–è€…å°äºç­‰äºã€çš„èŒƒå›´æŸ¥è¯¢ï¼Œè¦çœ‹æ¡ä»¶å€¼çš„è®°å½•æ˜¯å¦å­˜åœ¨äºè¡¨ä¸­ï¼š</li><li>å½“æ¡ä»¶å€¼çš„è®°å½•ä¸åœ¨è¡¨ä¸­ï¼Œé‚£ä¹ˆä¸ç®¡æ˜¯ã€Œå°äºã€è¿˜æ˜¯ã€Œå°äºç­‰äºã€æ¡ä»¶çš„èŒƒå›´æŸ¥è¯¢ï¼Œ æ‰«æåˆ°ç»ˆæ­¢èŒƒå›´æŸ¥è¯¢çš„è®°å½•æ—¶ï¼Œè¯¥è®°å½•çš„ç´¢å¼•çš„ next-key é”ä¼šé€€åŒ–æˆé—´éš™é” ï¼Œå…¶ä»–æ‰«æåˆ°çš„è®°å½•ï¼Œéƒ½æ˜¯åœ¨è¿™äº›è®°å½•çš„ç´¢å¼•ä¸ŠåŠ  next-key é”ã€‚</li><li>å½“æ¡ä»¶å€¼çš„è®°å½•åœ¨è¡¨ä¸­ï¼Œå¦‚æœæ˜¯ã€Œå°äºã€æ¡ä»¶çš„èŒƒå›´æŸ¥è¯¢ï¼Œ æ‰«æåˆ°ç»ˆæ­¢èŒƒå›´æŸ¥è¯¢çš„è®°å½•æ—¶ï¼Œè¯¥è®°å½•çš„ç´¢å¼•çš„ next-key é”ä¼šé€€åŒ–æˆé—´éš™é” ï¼Œå…¶ä»–æ‰«æåˆ°çš„è®°å½•ï¼Œéƒ½æ˜¯åœ¨è¿™äº›è®°å½•çš„ç´¢å¼•ä¸ŠåŠ  next-key é”ï¼›å¦‚æœã€Œå°äºç­‰äºã€æ¡ä»¶çš„èŒƒå›´æŸ¥è¯¢ï¼Œæ‰«æåˆ°ç»ˆæ­¢èŒƒå›´æŸ¥è¯¢çš„è®°å½•æ—¶ï¼Œè¯¥è®°å½•çš„ç´¢å¼• next-key é”ä¸ä¼šé€€åŒ–æˆé—´éš™é”ã€‚å…¶ä»–æ‰«æåˆ°çš„è®°å½•ï¼Œéƒ½æ˜¯åœ¨è¿™äº›è®°å½•çš„ç´¢å¼•ä¸ŠåŠ  next-key é”ã€‚</li></ul><p><strong>åŠ é”å¯¹è±¡ä¸æ˜¯ ç´¢å¼•</strong></p><p><strong>éå”¯ä¸€ç´¢å¼• ç­‰å€¼æŸ¥è¯¢</strong></p><p><strong>éå”¯ä¸€ç´¢å¼• èŒƒå›´æŸ¥è¯¢</strong></p><p><strong>æ­»é”</strong></p><p><strong>æ­»é”çš„å‘ç”Ÿ</strong></p><p>å»ºäº†ä¸€å¼ è®¢å•è¡¨ï¼Œå…¶ä¸­ id å­—æ®µä¸ºä¸»é”®ç´¢å¼•ï¼Œorder_no å­—æ®µæ™®é€šç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯éå”¯ä¸€ç´¢å¼•ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">t\_order</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> AUTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">order\_no</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\_date</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">id</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\_order</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">order\_no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">InnoDB ;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œå…ˆ t_order è¡¨é‡Œç°åœ¨å·²ç»æœ‰äº† 6 æ¡è®°å½•ï¼š</p><figure><img src="/assets/%E9%94%81.005-C0TWHUku.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>å‡è®¾è¿™æ—¶æœ‰ä¸¤äº‹åŠ¡ï¼Œä¸€ä¸ªäº‹åŠ¡è¦æ’å…¥è®¢å• 1007 ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¦æ’å…¥è®¢å• 1008ï¼Œå› ä¸ºéœ€è¦å¯¹è®¢å•åšå¹‚ç­‰æ€§æ ¡éªŒï¼Œæ‰€ä»¥ä¸¤ä¸ªäº‹åŠ¡å…ˆè¦æŸ¥è¯¢è¯¥è®¢å•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨æ‰æ’å…¥è®°å½•ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="/assets/%E9%94%81.006-Dtr23_T2.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªäº‹åŠ¡éƒ½é™·å…¥äº†ç­‰å¾…çŠ¶æ€ï¼ˆå‰ææ²¡æœ‰æ‰“å¼€æ­»é”æ£€æµ‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿäº†æ­»é”ï¼Œå› ä¸ºéƒ½åœ¨ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ã€‚</p><p>è¿™é‡Œåœ¨æŸ¥è¯¢è®°å½•æ˜¯å¦å­˜åœ¨çš„æ—¶å€™ï¼Œä½¿ç”¨äº† select ... for update è¯­å¥ï¼Œç›®çš„ä¸ºäº†é˜²æ­¢äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†è®°å½•ï¼Œè€Œå‡ºç°å¹»è¯»çš„é—®é¢˜ã€‚</p><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨ select ... for update è¯­å¥ï¼Œè€Œä½¿ç”¨äº†å•çº¯çš„ select è¯­å¥ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªè®¢å•å·ä¸€æ ·çš„è¯·æ±‚åŒæ—¶è¿›æ¥ï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªé‡å¤çš„è®¢å•ï¼Œæœ‰å¯èƒ½å‡ºç°å¹»è¯»ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/assets/%E9%94%81.007-C89lQIpK.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p><strong>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”ï¼Ÿ</strong></p><p>å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯å­˜åœ¨å¹»è¯»çš„é—®é¢˜ã€‚</p><p><strong>Innodb å¼•æ“ä¸ºäº†è§£å†³ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«ä¸‹çš„å¹»è¯»é—®é¢˜ï¼Œå°±å¼•å‡ºäº† next-key é”</strong> ï¼Œå®ƒæ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»„åˆã€‚</p><ul><li>Record Lockï¼Œè®°å½•é”ï¼Œé”çš„æ˜¯è®°å½•æœ¬èº«ï¼›</li><li>Gap Lockï¼Œé—´éš™é”ï¼Œé”çš„å°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç©ºéš™ï¼Œä»¥é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªç©ºéš™é—´æ’å…¥æ–°çš„æ•°æ®ï¼Œä»è€Œé¿å…å¹»è¯»ç°è±¡ã€‚</li></ul><p>æ™®é€šçš„ select è¯­å¥æ˜¯ä¸ä¼šå¯¹è®°å½•åŠ é”çš„ï¼Œå› ä¸ºå®ƒæ˜¯é€šè¿‡ MVCC çš„æœºåˆ¶å®ç°çš„å¿«ç…§è¯»ï¼Œå¦‚æœè¦åœ¨æŸ¥è¯¢æ—¶å¯¹è®°å½•åŠ è¡Œé”ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸¤ä¸ªæ–¹å¼ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>begin;</span></span>
<span class="line"><span>//å¯¹è¯»å–çš„è®°å½•åŠ å…±äº«é”</span></span>
<span class="line"><span>select ... lock in share mode;</span></span>
<span class="line"><span>commit; //é”é‡Šæ”¾</span></span>
<span class="line"><span>begin;</span></span>
<span class="line"><span>//å¯¹è¯»å–çš„è®°å½•åŠ æ’ä»–é”</span></span>
<span class="line"><span>select ... for update;</span></span>
<span class="line"><span>commit; //é”é‡Šæ”¾</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¡Œé”çš„é‡Šæ”¾æ—¶æœºæ˜¯åœ¨äº‹åŠ¡æäº¤ï¼ˆcommitï¼‰åï¼Œé”å°±ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶ä¸æ˜¯ä¸€æ¡è¯­å¥æ‰§è¡Œå®Œå°±é‡Šæ”¾è¡Œé”ã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹é¢äº‹åŠ¡ A æŸ¥è¯¢è¯­å¥ä¼šé”ä½ (2, +âˆ] èŒƒå›´çš„è®°å½•ï¼Œç„¶åæœŸé—´å¦‚æœæœ‰å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé”ä½çš„èŒƒå›´æ’å…¥æ•°æ®å°±ä¼šè¢«é˜»å¡ã€‚</p><figure><img src="/assets/%E9%94%81.008-9nT5d1WB.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>next-key é”çš„åŠ é”è§„åˆ™å…¶å®æŒºå¤æ‚çš„ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸‹ä¼šé€€åŒ–æˆè®°å½•é”æˆ–é—´éš™é”ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ update è¯­å¥çš„ where æ¡ä»¶æ²¡æœ‰ç”¨åˆ°ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆå°±ä¼šå…¨è¡¨æ‰«æï¼Œåœ¨ä¸€è¡Œè¡Œæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä»…ç»™è¡Œè®°å½•åŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜ç»™è¡Œè®°å½•ä¸¤è¾¹çš„ç©ºéš™ä¹ŸåŠ ä¸Šäº†é—´éš™é”ï¼Œç›¸å½“äºé”ä½æ•´ä¸ªè¡¨ï¼Œç„¶åç›´åˆ°äº‹åŠ¡ç»“æŸæ‰ä¼šé‡Šæ”¾é”ã€‚</p><p>å›åˆ°å‰é¢æ­»é”çš„ä¾‹å­ã€‚</p><figure><img src="/assets/%E9%94%81.006-Dtr23_T2.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>äº‹åŠ¡ A åœ¨æ‰§è¡Œä¸‹é¢è¿™æ¡è¯­å¥çš„æ—¶å€™ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>select id from t\_order where order\_no = 1007 for update;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ select * from performance_schema.data_locks\G; è¿™æ¡è¯­å¥ï¼ŒæŸ¥çœ‹äº‹åŠ¡æ‰§è¡Œ SQL è¿‡ç¨‹ä¸­åŠ äº†ä»€ä¹ˆé”ã€‚</p><figure><img src="/assets/%E9%94%81.009-CN-syrWs.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå…±åŠ äº†ä¸¤ä¸ªé”ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>è¡¨é”ï¼šX ç±»å‹çš„æ„å‘é”ï¼›</li><li>è¡Œé”ï¼šX ç±»å‹çš„é—´éš™é”ï¼›</li></ul><p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨è¡Œé”ï¼Œå›¾ä¸­ LOCK_TYPE ä¸­çš„ RECORD è¡¨ç¤ºè¡Œçº§é”ï¼Œè€Œä¸æ˜¯è®°å½•é”çš„æ„æ€ï¼Œé€šè¿‡ LOCK_MODE å¯ä»¥ç¡®è®¤æ˜¯ next-key é”ï¼Œè¿˜æ˜¯é—´éš™é”ï¼Œè¿˜æ˜¯è®°å½•é”ï¼š</p><ul><li>å¦‚æœ LOCK_MODE ä¸º X ï¼Œè¯´æ˜æ˜¯ X å‹çš„ next-key é”ï¼›</li><li>å¦‚æœ LOCK_MODE ä¸º X, REC_NOT_GAP ï¼Œè¯´æ˜æ˜¯ X å‹çš„è®°å½•é”ï¼›</li><li>å¦‚æœ LOCK_MODE ä¸º X, GAP ï¼Œè¯´æ˜æ˜¯ X å‹çš„é—´éš™é”ï¼›</li></ul><p><strong>å› æ­¤ï¼Œæ­¤æ—¶äº‹åŠ¡ A åœ¨äºŒçº§ç´¢å¼•ï¼ˆINDEX_NAME : index_orderï¼‰ä¸ŠåŠ çš„æ˜¯ X å‹çš„ next-key é”ï¼Œé”èŒƒå›´æ˜¯ (1006, +âˆ]</strong>ã€‚</p><p>next-key é”çš„èŒƒå›´ (1006, +âˆ]ï¼Œæ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Ÿ</p><p>å¦‚æœ LOCK_MODE æ˜¯ next-key é”æˆ–è€…é—´éš™é”ï¼Œé‚£ä¹ˆ LOCK_DATA å°±è¡¨ç¤ºé”çš„èŒƒå›´æœ€å³å€¼ï¼Œ</p><p>æ­¤æ¬¡çš„äº‹åŠ¡ A çš„ LOCK_DATA æ˜¯ supremum pseudo-recordï¼Œè¡¨ç¤ºçš„æ˜¯ +âˆã€‚ï¼ˆé˜²æ­¢æ’å…¥æ–°çš„æ•°æ®ï¼Œå¯¼è‡´ï¼‰</p><p>ç„¶åé”èŒƒå›´çš„æœ€å·¦å€¼æ˜¯ t_order è¡¨ä¸­æœ€åä¸€ä¸ªè®°å½•çš„ index_order çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 1006ã€‚å› æ­¤ï¼Œnext-key é”çš„èŒƒå›´ (1006, +âˆ]ã€‚</p><p>TIP</p><p>ã€Œå½“æŸ¥è¯¢çš„è®°å½•ä¸å­˜åœ¨æ—¶ï¼ŒåŠ  next-key lockï¼Œç„¶åä¼šé€€åŒ–ä¸ºé—´éš™é”ã€ã€‚ä¸ºä»€ä¹ˆä¸Šé¢äº‹åŠ¡ A çš„ next-key lock å¹¶æ²¡æœ‰é€€åŒ–ä¸ºé—´éš™é”ï¼Ÿ</p><p>å¦‚æœè¡¨ä¸­æœ€åä¸€ä¸ªè®°å½•çš„ order_no ä¸º 1005ï¼Œé‚£ä¹ˆç­‰å€¼æŸ¥è¯¢ order_no = 1006ï¼ˆä¸å­˜åœ¨ï¼‰ï¼Œå°±æ˜¯ next key lockï¼Œå¦‚ä¸Šé¢äº‹åŠ¡ A çš„æƒ…å†µã€‚<strong>é”èŒƒå›´ï¼ˆ1006ï¼Œ +âˆï¼‰</strong></p><p>å¦‚æœè¡¨ä¸­æœ€åä¸€ä¸ªè®°å½•çš„ order_no ä¸º 1010ï¼Œé‚£ä¹ˆç­‰å€¼æŸ¥è¯¢ order_no = 1006ï¼ˆä¸å­˜åœ¨ï¼‰ï¼Œå°±æ˜¯é—´éš™é”ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š<strong>é”èŒƒå›´ï¼ˆ1006ï¼Œ1010ï¼‰</strong></p><figure><img src="/assets/%E9%94%81.010-CjzFIa6V.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>å½“äº‹åŠ¡ B å¾€äº‹åŠ¡ A next-key é”çš„èŒƒå›´ (1006, +âˆ] é‡Œæ’å…¥ id = 1008 çš„è®°å½•å°±ä¼šè¢«é”ä½ï¼š</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Insert into t\_order (order\_no, create\_date) values (1008, now());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å› ä¸ºå½“æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ’å…¥è¯­å¥æ—¶ï¼Œä¼šåœ¨æ’å…¥é—´éš™ä¸Šè·å–æ’å…¥æ„å‘é”ï¼Œ <strong>è€Œæ’å…¥æ„å‘é”ä¸é—´éš™é”æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥å½“å…¶å®ƒäº‹åŠ¡æŒæœ‰è¯¥é—´éš™çš„é—´éš™é”æ—¶ï¼Œéœ€è¦ç­‰å¾…å…¶å®ƒäº‹åŠ¡é‡Šæ”¾é—´éš™é”ä¹‹åï¼Œæ‰èƒ½è·å–åˆ°æ’å…¥æ„å‘é”ã€‚è€Œé—´éš™é”ä¸é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œæ‰€ä»¥æ‰€ä»¥ä¸¤ä¸ªäº‹åŠ¡ä¸­ select ... for update è¯­å¥å¹¶ä¸ä¼šç›¸äº’å½±å“</strong> ã€‚</p><p>æ¡ˆä¾‹ä¸­çš„äº‹åŠ¡ A å’Œäº‹åŠ¡ B åœ¨æ‰§è¡Œå®Œå select ... for update è¯­å¥åéƒ½æŒæœ‰èŒƒå›´ä¸º (1006,+âˆ] çš„next-key é”ï¼Œè€Œæ¥ä¸‹æ¥çš„æ’å…¥æ“ä½œä¸ºäº†è·å–åˆ°æ’å…¥æ„å‘é”ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹äº‹åŠ¡çš„é—´éš™é”é‡Šæ”¾ï¼Œäºæ˜¯å°±é€ æˆäº†å¾ªç¯ç­‰å¾…ï¼Œå¯¼è‡´æ­»é”ã€‚</p><p>ä¸ºä»€ä¹ˆé—´éš™é”ä¸é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Ÿ</p><p><strong>é—´éš™é”çš„æ„ä¹‰åªåœ¨äºé˜»æ­¢åŒºé—´è¢«æ’å…¥</strong> ï¼Œå› æ­¤æ˜¯å¯ä»¥å…±å­˜çš„ã€‚ <strong>ä¸€ä¸ªäº‹åŠ¡è·å–çš„é—´éš™é”ä¸ä¼šé˜»æ­¢å¦ä¸€ä¸ªäº‹åŠ¡è·å–åŒä¸€ä¸ªé—´éš™èŒƒå›´çš„é—´éš™é”</strong> ï¼Œå…±äº«å’Œæ’ä»–çš„é—´éš™é”æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä»–ä»¬ç›¸äº’ä¸å†²çªï¼Œä¸”åŠŸèƒ½ç›¸åŒï¼Œå³ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™çš„é—´éš™é”ã€‚</p><p>è¿™é‡Œçš„å…±åŒé—´éš™åŒ…æ‹¬ä¸¤ç§åœºæ™¯ï¼š</p><ul><li>å…¶ä¸€æ˜¯ä¸¤ä¸ªé—´éš™é”çš„é—´éš™åŒºé—´å®Œå…¨ä¸€æ ·ï¼›</li><li>å…¶äºŒæ˜¯ä¸€ä¸ªé—´éš™é”åŒ…å«çš„é—´éš™åŒºé—´æ˜¯å¦ä¸€ä¸ªé—´éš™é”åŒ…å«é—´éš™åŒºé—´çš„å­é›†ã€‚</li></ul><p>ä½†æ˜¯æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œ <strong>next-key lock æ˜¯åŒ…å«é—´éš™é”+è®°å½•é”çš„ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº† X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ç›¸åŒèŒƒå›´çš„ X å‹çš„ next-key lock æ—¶ï¼Œæ˜¯ä¼šè¢«é˜»å¡çš„</strong> ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡æŒæœ‰äº†èŒƒå›´ä¸º (1, 10] çš„ X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ç›¸åŒèŒƒå›´çš„ X å‹çš„ next-key lock æ—¶ï¼Œå°±ä¼šè¢«é˜»å¡ã€‚</p><p>è™½ç„¶ç›¸åŒèŒƒå›´çš„é—´éš™é”æ˜¯å¤šä¸ªäº‹åŠ¡ç›¸äº’å…¼å®¹çš„ï¼Œä½†å¯¹äºè®°å½•é”ï¼Œæˆ‘ä»¬æ˜¯è¦è€ƒè™‘ X å‹ä¸ S å‹å…³ç³»ã€‚X å‹çš„è®°å½•é”ä¸ X å‹çš„è®°å½•é”æ˜¯å†²çªçš„ï¼Œæ¯”å¦‚ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œäº† select ... where id = 1 for updateï¼Œåä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿™æ¡è¯­å¥çš„æ—¶å€™ï¼Œå°±ä¼šè¢«é˜»å¡çš„ã€‚</p><p>ä½†æ˜¯è¿˜è¦æ³¨æ„ï¼å¯¹äºè¿™ç§èŒƒå›´ä¸º (1006, +âˆ] çš„ next-key lockï¼Œä¸¤ä¸ªäº‹åŠ¡æ˜¯å¯ä»¥åŒæ—¶æŒæœ‰çš„ï¼Œä¸ä¼šå†²çªã€‚å› ä¸º +âˆ å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸå®çš„è®°å½•ï¼Œè‡ªç„¶å°±ä¸éœ€è¦è€ƒè™‘ X å‹ä¸ S å‹å…³ç³»ã€‚</p><p>æ’å…¥æ„å‘é”æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ³¨æ„ï¼æ’å…¥æ„å‘é”åå­—è™½ç„¶æœ‰æ„å‘é”ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯æ„å‘é”ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ã€‚</p><p>è¿™æ®µè¯è¡¨æ˜å°½ç®¡ <strong>æ’å…¥æ„å‘é”æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œä½†ä¸åŒäºé—´éš™é”çš„æ˜¯ï¼Œè¯¥é”åªç”¨äºå¹¶å‘æ’å…¥æ“ä½œ</strong> ã€‚</p><p><strong>å¦‚æœè¯´é—´éš™é”é”ä½çš„æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œé‚£ä¹ˆã€Œæ’å…¥æ„å‘é”ã€é”ä½çš„å°±æ˜¯ä¸€ä¸ªç‚¹ã€‚å› è€Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œæ’å…¥æ„å‘é”ç¡®å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ã€‚</strong></p><p>æ’å…¥æ„å‘é”ä¸é—´éš™é”çš„å¦ä¸€ä¸ªéå¸¸é‡è¦çš„å·®åˆ«æ˜¯ï¼šå°½ç®¡ã€Œæ’å…¥æ„å‘é”ã€ä¹Ÿå±äºé—´éš™é”ï¼Œä½†ä¸¤ä¸ªäº‹åŠ¡å´ä¸èƒ½åœ¨åŒä¸€æ—¶é—´å†…ï¼Œä¸€ä¸ªæ‹¥æœ‰é—´éš™é”ï¼Œå¦ä¸€ä¸ªæ‹¥æœ‰è¯¥é—´éš™åŒºé—´å†…çš„æ’å…¥æ„å‘é”ï¼ˆå½“ç„¶ï¼Œæ’å…¥æ„å‘é”å¦‚æœä¸åœ¨é—´éš™é”åŒºé—´å†…åˆ™æ˜¯å¯ä»¥çš„ï¼‰ã€‚</p><p>å¦å¤–ï¼Œæˆ‘è¡¥å……ä¸€ç‚¹ï¼Œæ’å…¥æ„å‘é”çš„ç”Ÿæˆæ—¶æœºï¼š</p><ul><li>æ¯æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½éœ€è¦çœ‹ä¸€ä¸‹å¾…æ’å…¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•ä¸Šæ˜¯å¦å·²ç»è¢«åŠ äº†é—´éš™é”ï¼Œå¦‚æœå·²åŠ é—´éš™é”ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åé”çš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆ <em>PSï¼šMySQL åŠ é”æ—¶ï¼Œæ˜¯å…ˆç”Ÿæˆé”ç»“æ„ï¼Œç„¶åè®¾ç½®é”çš„çŠ¶æ€ï¼Œå¦‚æœé”çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼Œåªæœ‰å½“é”çŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€æ—¶ï¼Œæ‰ä»£è¡¨äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”</em> ï¼‰ï¼Œç°è±¡å°±æ˜¯ Insert è¯­å¥ä¼šè¢«é˜»å¡ã€‚</li></ul><p><strong>Insert è¯­å¥æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ</strong></p><p>Insert è¯­å¥åœ¨æ­£å¸¸æ‰§è¡Œæ—¶æ˜¯ä¸ä¼šç”Ÿæˆé”ç»“æ„çš„ï¼Œå®ƒæ˜¯é èšç°‡ç´¢å¼•è®°å½•è‡ªå¸¦çš„ trx_id éšè—åˆ—æ¥ä½œä¸º <strong>éšå¼é”</strong> æ¥ä¿æŠ¤è®°å½•çš„ã€‚</p><p>ä»€ä¹ˆæ˜¯éšå¼é”ï¼Ÿ</p><p>å½“äº‹åŠ¡éœ€è¦åŠ é”çš„æ—¶ï¼Œå¦‚æœè¿™ä¸ªé”ä¸å¯èƒ½å‘ç”Ÿå†²çªï¼ŒInnoDBä¼šè·³è¿‡åŠ é”ç¯èŠ‚ï¼Œè¿™ç§æœºåˆ¶ç§°ä¸ºéšå¼é”ã€‚</p><p>éšå¼é”æ˜¯ InnoDB å®ç°çš„ä¸€ç§å»¶è¿ŸåŠ é”æœºåˆ¶ï¼Œå…¶ç‰¹ç‚¹æ˜¯åªæœ‰åœ¨å¯èƒ½å‘ç”Ÿå†²çªæ—¶æ‰åŠ é”ï¼Œä»è€Œå‡å°‘äº†é”çš„æ•°é‡ï¼Œæé«˜äº†ç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚</p><p>éšå¼é”å°±æ˜¯åœ¨ Insert è¿‡ç¨‹ä¸­ä¸åŠ é”ï¼Œåªæœ‰åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ‰ä¼šå°†éšå¼é”è½¬æ¢ä¸ºæ˜¾ç¤ºé”ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ—ä¸¾ä¸¤ä¸ªåœºæ™¯ã€‚</p><ul><li>å¦‚æœè®°å½•ä¹‹é—´åŠ æœ‰é—´éš™é”ï¼Œä¸ºäº†é¿å…å¹»è¯»ï¼Œæ­¤æ—¶æ˜¯ä¸èƒ½æ’å…¥è®°å½•çš„ï¼›</li><li>å¦‚æœ Insert çš„è®°å½•å’Œå·²æœ‰è®°å½•å­˜åœ¨å”¯ä¸€é”®å†²çªï¼Œæ­¤æ—¶ä¹Ÿä¸èƒ½æ’å…¥è®°å½•ï¼›</li></ul><p><strong>1ã€è®°å½•ä¹‹é—´åŠ æœ‰é—´éš™é”</strong></p><p>æ¯æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½éœ€è¦çœ‹ä¸€ä¸‹å¾…æ’å…¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•ä¸Šæ˜¯å¦å·²ç»è¢«åŠ äº†é—´éš™é”ï¼Œå¦‚æœå·²åŠ é—´éš™é”ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åé”çš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆ <em>PSï¼šMySQL åŠ é”æ—¶ï¼Œæ˜¯å…ˆç”Ÿæˆé”ç»“æ„ï¼Œç„¶åè®¾ç½®é”çš„çŠ¶æ€ï¼Œå¦‚æœé”çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼Œåªæœ‰å½“é”çŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€æ—¶ï¼Œæ‰ä»£è¡¨äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”</em> ï¼‰ï¼Œç°è±¡å°±æ˜¯ Insert è¯­å¥ä¼šè¢«é˜»å¡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨ t_order è¡¨ä¸­ï¼Œåªæœ‰è¿™äº›æ•°æ®ï¼Œ <strong>order_no æ˜¯äºŒçº§ç´¢å¼•</strong> ã€‚</p><figure><img src="/assets/%E9%94%81.001-DN4g-5De.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ç°åœ¨ï¼Œäº‹åŠ¡ A æ‰§è¡Œäº†ä¸‹é¢è¿™æ¡è¯­å¥ã€‚</p><p><strong>äº‹åŠ¡ A mysql&gt; begin; Query OK, 0 rows affected (0.01 sec) mysql&gt; select * from t_order where order_no = 1006 for update; Empty set (0.01 sec)</strong></p><p>æ¥ç€ï¼Œæˆ‘ä»¬æ‰§è¡Œ select * from performance_schema.data_locks\G; è¯­å¥ ï¼Œç¡®å®šäº‹åŠ¡ A åŠ äº†ä»€ä¹ˆç±»å‹çš„é”ï¼Œè¿™é‡Œåªå…³æ³¨åœ¨è®°å½•ä¸ŠåŠ é”çš„ç±»å‹ã€‚</p><figure><img src="/assets/%E9%94%81.011-eV56RuSo.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>æœ¬æ¬¡çš„ä¾‹å­åŠ çš„æ˜¯ next-key é”ï¼ˆè®°å½•é”+é—´éš™é”ï¼‰ï¼Œé”èŒƒå›´æ˜¯ ï¼ˆ1005, +âˆ] ã€‚</p><p>ç„¶åï¼Œæœ‰ä¸ªäº‹åŠ¡ B åœ¨è¿™ä¸ªé—´éš™é”ä¸­ï¼Œæ’å…¥äº†ä¸€ä¸ªè®°å½•ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥äº‹åŠ¡ B å°±ä¼šè¢«é˜»å¡ï¼š</p><p><strong>äº‹åŠ¡ B æ’å…¥ä¸€æ¡è®°å½• mysql&gt; begin; Query OK, 0 rows affected (0.01 sec) mysql&gt; insert into t_order(order_no, create_date) values(1010,now()); é˜»å¡çŠ¶æ€ã€‚ã€‚ã€‚ã€‚</strong></p><p>æ¥ç€ï¼Œæˆ‘ä»¬æ‰§è¡Œ select * from performance_schema.data_locks\G; è¯­å¥ ï¼Œç¡®å®šäº‹åŠ¡ B åŠ äº†ä»€ä¹ˆç±»å‹çš„é”ï¼Œè¿™é‡Œåªå…³æ³¨åœ¨è®°å½•ä¸ŠåŠ é”çš„ç±»å‹ã€‚</p><figure><img src="/assets/%E9%94%81.012-02wiWQtG.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹åŠ¡ B çš„çŠ¶æ€ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆLOCK_STATUS: WAITINGï¼‰ï¼Œå› ä¸ºå‘äº‹åŠ¡ A ç”Ÿæˆçš„ next-key é”ï¼ˆè®°å½•é”+é—´éš™é”ï¼‰èŒƒå›´ ï¼ˆ1005, +âˆ] ä¸­æ’å…¥äº†ä¸€æ¡è®°å½•ï¼Œæ‰€ä»¥äº‹åŠ¡ B çš„æ’å…¥æ“ä½œç”Ÿæˆäº†ä¸€ä¸ªæ’å…¥æ„å‘é”ï¼ˆ LOCK_MODE: X,INSERT_INTENTION ï¼‰ï¼Œé”çš„çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œæ„å‘³ç€äº‹åŠ¡ B å¹¶æ²¡æœ‰æˆåŠŸè·å–åˆ°æ’å…¥æ„å‘é”ï¼Œå› æ­¤äº‹åŠ¡ B å‘ç”Ÿé˜»å¡ã€‚</p><p><strong>2ã€é‡åˆ°å”¯ä¸€é”®å†²çª</strong></p><p>å¦‚æœåœ¨æ’å…¥æ–°è®°å½•æ—¶ï¼Œæ’å…¥äº†ä¸€ä¸ªä¸ã€Œå·²æœ‰çš„è®°å½•çš„ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—å€¼ç›¸åŒã€çš„è®°å½•ï¼ˆä¸è¿‡å¯ä»¥æœ‰å¤šæ¡è®°å½•çš„å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—çš„å€¼åŒæ—¶ä¸ºNULLï¼Œè¿™é‡Œä¸è€ƒè™‘è¿™ç§æƒ…å†µï¼‰ï¼Œæ­¤æ—¶æ’å…¥å°±ä¼šå¤±è´¥ï¼Œç„¶åå¯¹äºè¿™æ¡è®°å½•åŠ ä¸Šäº† <strong>S å‹çš„é”</strong> ã€‚</p><ul><li>å¦‚æœä¸»é”®ç´¢å¼•é‡å¤ï¼Œæ’å…¥æ–°è®°å½•çš„äº‹åŠ¡ä¼šç»™å·²å­˜åœ¨çš„ä¸»é”®å€¼é‡å¤çš„èšç°‡ç´¢å¼•è®°å½• <strong>æ·»åŠ  S å‹è®°å½•é”</strong> ã€‚</li><li>å¦‚æœå”¯ä¸€äºŒçº§ç´¢å¼•é‡å¤ï¼Œæ’å…¥æ–°è®°å½•çš„äº‹åŠ¡éƒ½ä¼šç»™å·²å­˜åœ¨çš„äºŒçº§ç´¢å¼•åˆ—å€¼é‡å¤çš„äºŒçº§ç´¢å¼•è®°å½• <strong>æ·»åŠ  S å‹ next-key é”</strong> ã€‚</li></ul><p><strong>ä¸»é”®ç´¢å¼•å†²çª</strong></p><p>ä¸‹é¢ä¸¾ä¸ªã€Œä¸»é”®å†²çªã€çš„ä¾‹å­ï¼ŒMySQL 8.0 ç‰ˆæœ¬ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼ˆé»˜è®¤éš”ç¦»çº§åˆ«ï¼‰ã€‚</p><p>t_order è¡¨ä¸­çš„ id å­—æ®µä¸ºä¸»é”®ç´¢å¼•ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨ id å€¼ä¸º 5 çš„è®°å½•ï¼Œæ­¤æ—¶æœ‰ä¸ªäº‹åŠ¡ï¼Œæ’å…¥äº†ä¸€æ¡ id ä¸º 5 çš„è®°å½•ï¼Œå°±ä¼šæŠ¥ä¸»é”®ç´¢å¼•å†²çªçš„é”™è¯¯ã€‚</p><figure><img src="/assets/%E9%94%81.013-ysQmMsFk.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä½†æ˜¯é™¤äº†æŠ¥é”™ä¹‹å¤–ï¼Œè¿˜åšä¸€ä¸ªå¾ˆé‡è¦çš„äº‹æƒ…ï¼Œå°±æ˜¯å¯¹ id ä¸º 5 çš„è¿™æ¡è®°å½•åŠ ä¸Šäº† <strong>S å‹çš„è®°å½•é”</strong> ã€‚</p><p>å¯ä»¥æ‰§è¡Œ select * from performance_schema.data_locks\G; è¯­å¥ï¼Œç¡®å®šäº‹åŠ¡åŠ äº†ä»€ä¹ˆé”ã€‚</p><figure><img src="/assets/%E9%94%81.014-7uwOUwvr.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸»é”®ç´¢å¼•ä¸º 5 ï¼ˆLOCK_DATAï¼‰çš„è¿™æ¡è®°å½•ä¸­åŠ äº†é”ç±»å‹ä¸º S å‹çš„è®°å½•é”ã€‚æ³¨æ„ï¼Œè¿™é‡Œ LOCK_TYPE ä¸­çš„ RECORD è¡¨ç¤ºè¡Œçº§é”ï¼Œè€Œä¸æ˜¯è®°å½•é”çš„æ„æ€ã€‚å¦‚æœæ˜¯ S å‹è®°å½•é”çš„è¯ï¼ŒLOCK_MODE ä¼šæ˜¾ç¤º S, REC_NOT_GAP ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯é‡å¤è¯»ã€çš„æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œå‘ç”Ÿäº†ä¸»é”®ç´¢å¼•å†²çªï¼Œæ’å…¥æ–°è®°å½•çš„äº‹åŠ¡ä¼šç»™å·²å­˜åœ¨çš„ä¸»é”®å€¼é‡å¤çš„èšç°‡ç´¢å¼•è®°å½• <strong>æ·»åŠ  S å‹è®°å½•é”</strong> ã€‚</p><p><strong>å”¯ä¸€äºŒçº§ç´¢å¼•å†²çª</strong></p><p>ä¸‹é¢ä¸¾ä¸ªã€Œå”¯ä¸€äºŒçº§ç´¢å¼•å†²çªã€çš„ä¾‹å­ï¼ŒMySQL 8.0 ç‰ˆæœ¬ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼ˆé»˜è®¤éš”ç¦»çº§åˆ«ï¼‰ã€‚</p><p>t_order è¡¨ä¸­çš„ order_no å­—æ®µä¸ºå”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨ order_no å€¼ä¸º 1001 çš„è®°å½•ï¼Œæ­¤æ—¶äº‹åŠ¡ Aï¼Œæ’å…¥äº† order_no ä¸º 1001 çš„è®°å½•ï¼Œå°±å‡ºç°äº†æŠ¥é”™ã€‚</p><figure><img src="/assets/%E9%94%81.015-BBUA6BTb.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä½†æ˜¯é™¤äº†æŠ¥é”™ä¹‹å¤–ï¼Œè¿˜åšä¸€ä¸ªå¾ˆé‡è¦çš„äº‹æƒ…ï¼Œå°±æ˜¯å¯¹ order_no å€¼ä¸º 1001 è¿™æ¡è®°å½•åŠ ä¸Šäº† <strong>S å‹çš„ next-key é”</strong> ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ‰§è¡Œ select * from performance_schema.data_locks\G; è¯­å¥ ï¼Œç¡®å®šäº‹åŠ¡åŠ äº†ä»€ä¹ˆç±»å‹çš„é”ï¼Œè¿™é‡Œåªå…³æ³¨åœ¨è®°å½•ä¸ŠåŠ é”çš„ç±»å‹ã€‚</p><figure><img src="/assets/%E9%94%81.016-BL5u03UY.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ <strong>index_order äºŒçº§ç´¢å¼•åŠ äº† S å‹çš„ next-key é”ï¼ŒèŒƒå›´æ˜¯(-âˆ, 1001]</strong> ã€‚æ³¨æ„ï¼Œè¿™é‡Œ LOCK_TYPE ä¸­çš„ RECORD è¡¨ç¤ºè¡Œçº§é”ï¼Œè€Œä¸æ˜¯è®°å½•é”çš„æ„æ€ã€‚å¦‚æœæ˜¯è®°å½•é”çš„è¯ï¼ŒLOCK_MODE ä¼šæ˜¾ç¤º S, REC_NOT_GAP ã€‚</p><p>æ­¤æ—¶ï¼Œäº‹åŠ¡ B æ‰§è¡Œäº† select * from t_order where order_no = 1001 for update; å°±ä¼šé˜»å¡ï¼Œå› ä¸ºè¿™æ¡è¯­å¥<strong>æƒ³åŠ  X å‹çš„é”ï¼Œæ˜¯ä¸ S å‹çš„é”æ˜¯å†²çª</strong>çš„ï¼Œæ‰€ä»¥å°±ä¼šè¢«é˜»å¡ã€‚</p><figure><img src="/assets/%E9%94%81.017-DykDSdFB.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä» performance_schema.data_locks è¿™ä¸ªè¡¨ä¸­çœ‹åˆ°ï¼Œäº‹åŠ¡ B çš„çŠ¶æ€ï¼ˆLOCK_STATUSï¼‰æ˜¯ç­‰å¾…çŠ¶æ€ï¼ŒåŠ é”çš„ç±»å‹ X å‹çš„è®°å½•é”ï¼ˆLOCK_MODE: X,REC_NOT_GAP ï¼‰ã€‚</p><figure><img src="/assets/%E9%94%81.018-CxDSoLT8.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä¸Šé¢çš„æ¡ˆä¾‹æ˜¯é’ˆå¯¹å”¯ä¸€äºŒçº§ç´¢å¼•é‡å¤è€Œæ’å…¥å¤±è´¥çš„åœºæ™¯ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåˆ†æä¸¤ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç›¸åŒçš„ insert è¯­å¥çš„åœºæ™¯ã€‚</p><p>ç°åœ¨ t_order è¡¨ä¸­ï¼Œåªæœ‰è¿™äº›æ•°æ®ï¼Œ <strong>order_no ä¸ºå”¯ä¸€äºŒçº§ç´¢å¼•</strong> ã€‚</p><figure><img src="/assets/%E9%94%81.001-DN4g-5De.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>åœ¨éš”ç¦»çº§åˆ«å¯é‡å¤è¯»çš„æƒ…å†µä¸‹ï¼Œå¼€å¯ä¸¤ä¸ªäº‹åŠ¡ï¼Œå‰åæ‰§è¡Œç›¸åŒçš„ Insert è¯­å¥ï¼Œæ­¤æ—¶ <strong>äº‹åŠ¡ B çš„ Insert è¯­å¥ä¼šå‘ç”Ÿé˜»å¡</strong> ã€‚</p><figure><img src="/assets/%E9%94%81.019-QA8INeHp.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä¸¤ä¸ªäº‹åŠ¡çš„åŠ é”è¿‡ç¨‹ï¼š</p><ul><li>äº‹åŠ¡ A å…ˆæ’å…¥ order_no ä¸º 1006 çš„è®°å½•ï¼Œå¯ä»¥æ’å…¥æˆåŠŸï¼Œæ­¤æ—¶å¯¹åº”çš„å”¯ä¸€äºŒçº§ç´¢å¼•è®°å½•è¢«ã€Œéšå¼é”ã€ä¿æŠ¤ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰å®é™…çš„é”ç»“æ„ï¼ˆæ‰§è¡Œå®Œè¿™é‡Œçš„æ—¶å€™ï¼Œä½ å¯ä»¥çœ‹æŸ¥ performance_schema.data_locks ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ¡è®°å½•æ˜¯æ²¡æœ‰åŠ ä»»ä½•é”çš„ï¼‰ï¼›</li><li>æ¥ç€ï¼Œäº‹åŠ¡ B ä¹Ÿæ’å…¥ order_no ä¸º 1006 çš„è®°å½•ï¼Œç”±äºäº‹åŠ¡ A å·²ç»æ’å…¥ order_no å€¼ä¸º 1006 çš„è®°å½•ï¼Œæ‰€ä»¥äº‹åŠ¡ B åœ¨æ’å…¥äºŒçº§ç´¢å¼•è®°å½•æ—¶ä¼šé‡åˆ°é‡å¤çš„å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—å€¼ï¼Œæ­¤æ—¶äº‹åŠ¡ B æƒ³è·å–ä¸€ä¸ª S å‹ next-key é”ï¼Œä½†æ˜¯äº‹åŠ¡ A å¹¶æœªæäº¤ï¼Œ <strong>äº‹åŠ¡ A æ’å…¥çš„ order_no å€¼ä¸º 1006 çš„è®°å½•ä¸Šçš„ã€Œéšå¼é”ã€ä¼šå˜ã€Œæ˜¾ç¤ºé”ã€ä¸”é”ç±»å‹ä¸º X å‹çš„è®°å½•é”ï¼Œæ‰€ä»¥äº‹åŠ¡ B å‘è·å– S å‹ next-key é”æ—¶ä¼šé‡åˆ°é”å†²çªï¼Œäº‹åŠ¡ B è¿›å…¥é˜»å¡çŠ¶æ€</strong> ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥æ‰§è¡Œ select * from performance_schema.data_locks\G; è¯­å¥ ï¼Œç¡®å®šäº‹åŠ¡åŠ äº†ä»€ä¹ˆç±»å‹çš„é”ï¼Œè¿™é‡Œåªå…³æ³¨åœ¨è®°å½•ä¸ŠåŠ é”çš„ç±»å‹ã€‚</p><p>å…ˆçœ‹äº‹åŠ¡ A å¯¹ order_no ä¸º 1006 çš„è®°å½•åŠ äº†ä»€ä¹ˆé”ï¼Ÿ</p><p>ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œ <strong>äº‹åŠ¡ A å¯¹ order_no ä¸º 1006 è®°å½•åŠ ä¸Šäº†ç±»å‹ä¸º X å‹çš„è®°å½•é”</strong> ï¼ˆ <em>æ³¨æ„ï¼Œè¿™ä¸ªæ˜¯åœ¨æ‰§è¡Œäº‹åŠ¡ B ä¹‹åæ‰äº§ç”Ÿçš„é”ï¼Œæ²¡æ‰§è¡Œäº‹åŠ¡ B ä¹‹å‰ï¼Œè¯¥è®°å½•è¿˜æ˜¯éšå¼é”</em> ï¼‰ã€‚</p><figure><img src="/assets/%E9%94%81.020-EwjblVws.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ç„¶åçœ‹äº‹åŠ¡ B æƒ³å¯¹ order_no ä¸º 1006 çš„è®°å½•åŠ ä»€ä¹ˆé”ï¼Ÿ</p><p>ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œ <strong>äº‹åŠ¡ B æƒ³å¯¹ order_no ä¸º 1006 çš„è®°å½•åŠ  S å‹çš„ next-key é”ï¼Œä½†æ˜¯ç”±äºäº‹åŠ¡ A åœ¨è¯¥è®°å½•ä¸ŠæŒæœ‰äº† X å‹çš„è®°å½•é”ï¼Œè¿™ä¸¤ä¸ªé”æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥å¯¼è‡´äº‹åŠ¡ B å¤„äºç­‰å¾…çŠ¶æ€</strong> ã€‚</p><figure><img src="/assets/%E9%94%81.021-DdKDL_k6.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p>ä»è¿™ä¸ªå®éªŒå¯ä»¥å¾—çŸ¥ï¼Œå¹¶å‘å¤šä¸ªäº‹åŠ¡çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡æ’å…¥çš„è®°å½•ï¼Œå¹¶ä¸ä¼šåŠ é”ï¼Œè€Œæ˜¯ä¼šç”¨éšå¼é”ä¿æŠ¤å”¯ä¸€äºŒçº§ç´¢å¼•çš„è®°å½•ã€‚</p><p>ä½†æ˜¯å½“ç¬¬ä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤çš„æ—¶å€™ï¼Œæœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†ä¸ç¬¬ä¸€ä¸ªäº‹åŠ¡ç›¸åŒçš„è®°å½•ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡å°±ä¼š <strong>è¢«é˜»å¡</strong> ï¼Œ <strong>å› ä¸ºæ­¤æ—¶ç¬¬ä¸€äº‹åŠ¡æ’å…¥çš„è®°å½•ä¸­çš„éšå¼é”ä¼šå˜ä¸ºæ˜¾ç¤ºé”ä¸”ç±»å‹æ˜¯ X å‹çš„è®°å½•é”ï¼Œè€Œç¬¬äºŒä¸ªäº‹åŠ¡æ˜¯æƒ³å¯¹è¯¥è®°å½•åŠ ä¸Š S å‹çš„ next-key é”ï¼ŒX å‹ä¸ S å‹çš„é”æ˜¯å†²çªçš„</strong> ï¼Œæ‰€ä»¥å¯¼è‡´ç¬¬äºŒä¸ªäº‹åŠ¡ä¼šç­‰å¾…ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªäº‹åŠ¡æäº¤åï¼Œé‡Šæ”¾äº†é”ã€‚</p><p>å¦‚æœ order_no ä¸æ˜¯å”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œé‚£ä¹ˆä¸¤ä¸ªäº‹åŠ¡ï¼Œå‰åæ‰§è¡Œç›¸åŒçš„ Insert è¯­å¥ï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿé˜»å¡çš„ï¼Œå°±å¦‚å‰é¢çš„è¿™ä¸ªä¾‹å­ã€‚</p><figure><img src="/assets/%E9%94%81.007-C89lQIpK.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><p><strong>å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</strong></p><p>æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p><p><strong>äº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯å¼ºå ç”¨ã€å¾ªç¯ç­‰å¾…</strong> ã€‚</p><p>åªè¦ç³»ç»Ÿå‘ç”Ÿæ­»é”ï¼Œè¿™äº›æ¡ä»¶å¿…ç„¶æˆç«‹ï¼Œä½†æ˜¯åªè¦ç ´åä»»æ„ä¸€ä¸ªæ¡ä»¶å°±æ­»é”å°±ä¸ä¼šæˆç«‹ã€‚</p><p>å½“æœ‰æ­»é”å‘ç”Ÿæ—¶ï¼Œè§£é™¤æ­»é”ç­–ç•¥</p><p>åœ¨æ•°æ®åº“å±‚é¢ï¼Œæœ‰ä¸¤ç§ç­–ç•¥é€šè¿‡ã€Œæ‰“ç ´å¾ªç¯ç­‰å¾…æ¡ä»¶ã€æ¥è§£é™¤æ­»é”çŠ¶æ€ï¼š</p><ul><li><strong>è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„è¶…æ—¶æ—¶é—´</strong> ã€‚å½“ä¸€ä¸ªäº‹åŠ¡çš„ç­‰å¾…æ—¶é—´è¶…è¿‡è¯¥å€¼åï¼Œå°±å¯¹è¿™ä¸ªäº‹åŠ¡è¿›è¡Œå›æ»šï¼Œäºæ˜¯é”å°±é‡Šæ”¾äº†ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚ åœ¨ InnoDB ä¸­ï¼Œå‚æ•° innodb_lock_wait_timeout æ˜¯ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´çš„ï¼Œé»˜è®¤å€¼æ—¶ 50 ç§’ã€‚ å½“å‘ç”Ÿè¶…æ—¶åï¼Œå°±å‡ºç°ä¸‹é¢è¿™ä¸ªæç¤ºï¼š</li></ul><figure><img src="/assets/%E9%94%81.022-DMUcrYB9.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure><ul><li><strong>å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹</strong> ã€‚ä¸»åŠ¨æ­»é”æ£€æµ‹åœ¨å‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚ å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼Œé»˜è®¤å°±å¼€å¯ã€‚ å½“æ£€æµ‹åˆ°æ­»é”åï¼Œå°±ä¼šå‡ºç°ä¸‹é¢è¿™ä¸ªæç¤ºï¼š</li></ul><figure><img src="/assets/%E9%94%81.023-Z8XnsQMI.png" alt="..." tabindex="0" loading="lazy"><figcaption>...</figcaption></figure></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/3/31 15:53:39</span></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 1582877056@qq.com">kryiea</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/back-end/mysql/principle/%E4%BA%8B%E5%8A%A1.html" aria-label="MySQLäº‹åŠ¡æœºåˆ¶è¯¦è§£"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->MySQLäº‹åŠ¡æœºåˆ¶è¯¦è§£</div></a><a class="route-link auto-link next" href="/back-end/mysql/principle/%E6%97%A5%E5%BF%97.html" aria-label="MySQLæ—¥å¿—ç³»ç»ŸåŸç†è¯¦è§£"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">MySQLæ—¥å¿—ç³»ç»ŸåŸç†è¯¦è§£<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><!----><div class="vp-copyright">Copyright Â© 2025 kryiea </div></footer></div><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DRR9Yo7Y.js" defer></script>
  </body>
</html>
